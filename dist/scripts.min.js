/*! GAMEDEX - v0.1.0 - 2013-01-07
* http://www.gamedex.net/
* 2013 - Michael Martin */
(function(e){function a(r,i){this.element=r,this.options=e.extend({},n,i),this._defaults=n,this._name=t,this.init()}var t="BootstrapSubMenu",n={propertyName:"value"},r=null,i=null,s=null,o=null,u=!1;a.prototype.init=function(){this.createEventHandlers(e(this.element),this.options.$mainNav)},a.prototype.createEventHandlers=function(t,n){n.click(function(e){u=!1}),n.find("li:not(.dropdown-sub li)").hover(function(e){clearTimeout(s),s=null,o||(o=setTimeout(function(){t.removeClass("active")},500))}),t.hover(function(e){clearTimeout(o),o=null,s||(s=setTimeout(function(){u||t.addClass("active")},300))}),t.click(function(e){e.preventDefault(),e.stopPropagation()}),t.find("li").hover(function(e){clearTimeout(o),o=null}),t.find("li").click(function(e){u=!0,t.removeClass("active"),n.removeClass("open")}),n.find(".dropdown-toggle").click(function(e){t.removeClass("active")}),e(document).click(function(e){t.removeClass("active")})},e.fn[t]=function(n){return this.each(function(){e.data(this,"plugin_"+t)||e.data(this,"plugin_"+t,new a(this,n))})}})(jQuery);var tmz={module:function(){var e={};return function(t){return e[t]?e[t]:e[t]={}}}()};tmz.api="/",tmz.initialize=function(){tmz.initializeLibraries(),tmz.initializeModules()},tmz.initializeLibraries=function(){moment.calendar={lastDay:"LL",sameDay:"LL",nextDay:"LL",lastWeek:"LL",nextWeek:"LL",sameElse:"LL"},moment.longDateFormat={L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D YYYY h:mm A",LLLL:"dddd, MMMM D YYYY h:mm A"}},tmz.initializeModules=function(){var e=tmz.module("itemData"),t=tmz.module("searchView"),n=tmz.module("detailView"),r=tmz.module("itemView"),i=tmz.module("tagView"),s=tmz.module("gridView"),o=tmz.module("filterPanel"),u=tmz.module("videoPanel"),a=tmz.module("importView"),f=tmz.module("siteView");e.init(),t.init(),n.init(),r.init(),i.init(),s.init(),o.init(),u.init(),a.init(),f.init()},function(e,t,n,r){"use strict";var i=t.module("user"),s=[{id:"all",gt:"",ign:"",gamestats:"",amazon:468642,alias:"all",name:"All Platforms"},{id:"pc",gt:"pc",ign:"pc",gamestats:"pc",amazon:229575,alias:"pc,windows",name:"PC"},{id:"mac",gt:"",ign:"",gamestats:"pc",amazon:229647,alias:"mac,macwindows,osx,os x,apple,macintosh",name:"Mac"},{id:"xbox",gt:"",ign:"",gamestats:"xbox",amazon:537504,alias:"xbox,microsoft xbox",name:"Xbox"},{id:"x360",gt:"xbox 360",ign:"x360",gamestats:"xbox-360",amazon:14220161,alias:"x360,xbox 360,microsoft xbox360,360",name:"X360"},{id:"xbl",gt:"xbla",ign:"x360&downloadType=1",gamestats:"xbox-360",amazon:14220161,alias:"xbl,xbox live",name:"XBL"},{id:"ds",gt:"ds",ign:"ds",gamestats:"nintendo-ds",amazon:11075831,alias:"ds,nintendo ds",name:"DS"},{id:"3ds",gt:"3ds",ign:"ds",gamestats:"nintendo-ds",amazon:2622269011,alias:"3ds,nintendo 3ds",name:"3DS"},{id:"wii",gt:"wii",ign:"wii",gamestats:"wii",amazon:14218901,alias:"wii,nintendo wii",name:"Wii"},{id:"wiiu",gt:"wii u",ign:"wii u",gamestats:"wii u",amazon:3075112011,alias:"wiiu,wii u,wii-u,nintendo wii u,nintendo wiiu",name:"Wii U"},{id:"ps",gt:"",ign:"",gamestats:"playstation",amazon:229773,alias:"ps,ps1,playstation,playstation1,playstation 1,sony playstation 1,sony playstation",name:"PS1"},{id:"ps2",gt:"",ign:"",gamestats:"playstation-2",amazon:301712,alias:"ps2,playstation 2,playstation2,sony playstation 2",name:"PS2"},{id:"ps3",gt:"ps3",ign:"ps3",gamestats:"playstation-3",amazon:14210751,alias:"ps3,playstation 3,playstation3,sony playstation 3",name:"PS3"},{id:"psn",gt:"",ign:"ps3&downloadType=201",gamestats:"playstation-3",amazon:14210751,alias:"psn,playstation network",name:"PSN"},{id:"vita",gt:"vita",ign:"ps-vita",gamestats:"playstation-3",amazon:3010556011,alias:"vita,psvita,ps vita,playstation vita,sony vita,sony playstation vita",name:"Vita"},{id:"psp",gt:"",ign:"",gamestats:"playstation-portable",amazon:11075221,alias:"psp,sony psp",name:"PSP"},{id:"gc",gt:"",ign:"",gamestats:"gamecube",amazon:541022,alias:"gamecube,gc,nintendo gamecube",name:"Gamecube"},{id:"n64",gt:"",ign:"",gamestats:"nintendo-64",amazon:229763,alias:"n64,nintendo 64,nintendo64",name:"N64"},{id:"nes",gt:"",ign:"",gamestats:"nes",amazon:566458,alias:"nes,nintendo nes",name:"NES"},{id:"snes",gt:"",ign:"",gamestats:"super-nes",amazon:294945,alias:"snes,super nintendo,nintendo snes",name:"SNES"},{id:"gba",gt:"",ign:"",gamestats:"gameboy-advance",amazon:1272528011,alias:"gb,gameboy",name:"Game Boy"},{id:"gb",gt:"",ign:"",gamestats:"game-boy",amazon:541020,alias:"gba,gameboy advance,game boy,advance,gbadvance",name:"GBA"},{id:"gbc",gt:"",ign:"",gamestats:"game-boy-color",amazon:229783,alias:"gbc,gbcolor,gameboy color",name:"GBC"},{id:"dc",gt:"",ign:"",gamestats:"dreamcast",amazon:229793,alias:"dc,dreamcast,sega dreamcast,sega dream cast,dream cast",name:"Dreamcast"},{id:"saturn",gt:"",ign:"",gamestats:"saturn",amazon:294944,alias:"saturn,sega saturn",name:"Saturn"},{id:"genesis",gt:"",ign:"",gamestats:"genesis",amazon:294943,alias:"genesis,sega genesis",name:"Genesis"},{id:"gamegear",gt:"",ign:"",gamestats:"game-gear",amazon:294942,alias:"gamegear,game gear,sega gamegear",name:"Gamegear"},{id:"segacd",gt:"",ign:"",gamestats:"sega-cd",amazon:11000181,alias:"cd,sega cd",name:"Sega CD"}],o={Amazon:0,GiantBomb:1},u="0",a={URL:"http://ecx.images-amazon.com/images",RE:/http:\/\/ecx\.images-amazon\.com\/images/gi,TOKEN:"~1~"},f={URL:"http://media.giantbomb.com/uploads",RE:/http:\/\/media\.giantbomb\.com\/uploads/gi,TOKEN:"~1~"},l=function(e){var t=new RegExp(e,"gi");for(var n=0,r=s.length;n<r;n++)if(t.test(s[n].alias))return s[n];return s[0]},c=function(e){var t=null,n=[],r=null,i=e.length,o=0,u=null;for(var a=0,f=s.length;a<f;a++){n=s[a].alias.split(",");for(var l=0,c=n.length;l<c;l++){t=new RegExp(n[l],"gi"),u=t.exec(e);if(u&&u[0].length===i)return s[a];u&&u[0].length>o&&(o=u[0].length,r=s[a])}}return r?r:s[0]},h={PLATFORM_INDEX:s,SEARCH_PROVIDERS:o,VIEW_ALL_TAG_ID:u,AMAZON_IMAGE:a,GIANTBOMB_IMAGE:f,getStandardPlatform:l,matchPlatformToIndex:c};n.extend(e,h)}(tmz.module("utilities"),tmz,jQuery,_),function(e,t,n,r,i){"use strict";var s=t.module("utilities"),o=t.module("storage"),u=t.module("itemView"),a=t.module("itemCache"),f=t.api+"user/login/",l=t.api+"user/logout/",c=t.api+"user/",h=t.api+"user/create/",p=t.api+"user/update/",d=t.api+"user/resetcode/send/",v=t.api+"user/resetcode/submit/",m=t.api+"user/password/update/",g={user_id:"",secret_key:"",viewUser:null},y={user_id:"1",secret_key:"1"};e.getUserData=function(e){return g},e.getUserCredentials=function(e){return e=typeof e!="undefined"?e:!1,g.timestamp=(new Date).getTime(),e&&o.set("timestamp",g.timestamp),g.viewUser?{user_name:g.viewUser}:e?{uid:g.user_id,uk:g.secret_key,ts:g.timestamp}:{uid:g.user_id,uk:g.secret_key}},e.getUserID=function(){return g.user_id},e.login=function(e,t,r,s){i.success("Logging in... "+e);var o={user_email:e,user_password:t};n.ajax({url:f,type:"POST",data:o,dataType:"json",cache:!0,success:function(t){w(t,e),r(t,e)},error:s})},e.demoLogin=function(){g.user_id=y.user_id,g.secret_key=y.secret_key},e.validateUser=function(e,t){var r={user_name:e};n.ajax({url:c,type:"POST",data:r,dataType:"json",cache:!0,success:function(e){E(e),t(e)},error:function(e){}})},e.logout=function(e){i.success("Logged out");var t={uid:g.user_id,uk:g.secret_key};n.ajax({url:l,type:"POST",data:t,dataType:"json",cache:!0,success:function(e){},error:function(e){}}),g.user_id=null,g.secret_key=null,g.userName=null,g.email=null,g.viewUser=null},e.createUser=function(e,t,r,s){i.success("Creating account : "+e);var o={user_email:e,user_password:t};n.ajax({url:h,type:"POST",data:o,dataType:"json",cache:!0,success:function(t){w(t,e),r(t,e)},error:s})},e.updateUser=function(e,t,r,i,s){if(e!==""){var o={uid:g.user_id,user_password:e};r!==g.userName&&(o.user_name=r),t!==g.email&&(o.user_email=t),i!==""&&(o.user_new_password=i),o.user_password=e,n.ajax({url:p,type:"POST",data:o,dataType:"json",cache:!0,success:function(e){e.status==="success"&&b(o),s(e)},error:function(e){}})}},e.sendResetPasswordCode=function(e,t){var r={user_email:e};n.ajax({url:d,type:"POST",data:r,dataType:"json",cache:!0,success:function(e){t(e)},error:function(e){}})},e.submitResetPasswordCode=function(e,t,r){var i={user_email:e,user_reset_code:t};n.ajax({url:v,type:"POST",data:i,dataType:"json",cache:!0,success:function(e){r(e)},error:function(e){}})},e.updatePassword=function(e,t,r,i){var s={user_email:e,user_reset_code:t,user_new_password:r};n.ajax({url:m,type:"POST",data:s,dataType:"json",cache:!0,success:function(e){i(e)},error:function(e){}})},e.isViewUser=function(){return g.viewUser?!0:!1};var b=function(e){typeof e.user_name!="undefined"&&(g.userName=e.user_name),typeof e.user_email!="undefined"&&(g.email=e.user_email)},w=function(e,t){if(e.userID){g.user_id=e.userID,g.secret_key=e.secretKey,g.userName=e.userName,g.email=t,g.viewUser=null,i.success("Welcome "+e.userName);var n=o.get("timestamp");n?e.timestamp!=n&&(a.clearStoredData(),o.set("timestamp",e.timestamp)):o.set("timestamp",e.timestamp)}},E=function(e){e.status==="success"&&(g.viewUser=e.userName,g.user_id=e.userName,g.secret_key=0)}}(tmz.module("user"),tmz,jQuery,_,alertify),function(e,t,n,r){"use strict";var i=t.module("user");e.get=function(e){var t=i.getUserID(),n=localStorage.getItem(t+"_"+e),r=null;return n!=="undefined"&&n&&(r=JSON.parse(n)),r},e.set=function(e,t){if(!i.isViewUser()){var n=i.getUserID();localStorage.setItem(n+"_"+e,JSON.stringify(t)),t||(t={})}return t},e.remove=function(e){var t=i.getUserID();localStorage.removeItem(t+"_"+e)},e.setGlobal=function(e,t){return localStorage.setItem(e,JSON.stringify(t)),t||(t={}),t},e.getGlobal=function(e){var t=localStorage.getItem(e),n=null;return t&&(n=JSON.parse(t)),n},e.removeGlobal=function(e){localStorage.removeItem(e)},e.clearStorage=function(){localStorage.clear()}}(tmz.module("storage"),tmz,jQuery,_),function(e,t,n,r,i,s){"use strict";var o=t.module("user"),u=t.module("itemLinker"),a=t.module("itemCache"),f=t.module("tagView"),l=t.module("utilities"),c=t.api+"item/directory/",h=t.api+"item/",p=t.api+"item/add/",d=t.api+"item/delete/batch/",v=t.api+"item/delete/",m=t.api+"item/user/update/",g=t.api+"item/shared/update/",y=t.api+"item/metacritic/update/",b=t.api+"import/",w=l.VIEW_ALL_TAG_ID,E={},S={},x={},T={},N=function(){n(document).keypress(function(e){e.which==96&&(console.warn("------------ itemDataDirectory: -------",S),console.warn("------------ amazonDirectory: -------",x),console.warn("------------ giantBombDirectory: -------",T),console.warn("------------ items: -------------------",E))})},C=function(e){a.cacheItemsByTag(e,S)},k=function(e,t){var r=null,i=o.getUserCredentials(),s=a.getStoredItemDirectory();if(s)A(s),e&&e(s);else{var u={};n.extend(!0,u,i),r=n.ajax({url:c,type:"POST",data:u,dataType:"json",cache:!0,success:function(t){L(t),a.storeItemDirectory(S),e&&e(t)},error:function(e){}})}return r},L=function(e){var t={};r.each(e.directory,function(e,n){t={itemID:n,asin:e.aid,gbombID:e.gid,gameStatus:e.gs,playStatus:e.ps,tags:e.t,tagCount:e.tc,userRating:e.ur},Q(t)})},A=function(e){var t={};r.each(e,function(e){Q(e)})},O=function(e,t,r){var i=null,s=a.getCachedItemsByTag(e);if(s)E=s,t(s);else{var u={list_id:e},f=o.getUserCredentials();n.extend(!0,u,f),i=n.ajax({url:h,type:"POST",data:u,dataType:"json",cache:!0,success:function(e){E=M(e),t(E)},error:r})}return i},M=function(e){var t={},n={},r=0,i=null;for(var s=0,o=e.items.length;s<o;s++){n={};var u=e.items[s].ip,a=e.items[s].ib||"",f=B(e.items[s].si,a,u),l=B(e.items[s].ti,a,u),c=B(e.items[s].li,a,u);n.id=e.items[s].iid,n.initialProvider=e.items[s].ip,n.itemID=e.items[s].iid,n.asin=e.items[s].aid,n.gbombID=e.items[s].gid,n.name=e.items[s].n,n.releaseDate=e.items[s].rd,n.platform=e.items[s].p,n.smallImage=f,n.thumbnailImage=l,n.largeImage=c,n.metascore=e.items[s].ms,n.metascorePage=e.items[s].mp,n.offers={},n.description="",X(n),t[n.itemID]=n}return t},_=function(e){return E[e]},D=function(e,t,i,u){var a=null,l=o.getUserCredentials(!0),c=n.extend(!0,{},t),h=H(c.smallImage,c.initialProvider),d=H(c.thumbnailImage,c.initialProvider),v=H(c.largeImage,c.initialProvider),m=h.split(""),g=d.split(""),y=v.split(""),b=P(m,g,y),w=m.slice(0,b).join("");h=m.slice(b).join(""),d=g.slice(b).join(""),v=y.slice(b).join("");var E={lids:e,n:c.name,rd:c.releaseDate,aid:c.asin,gid:c.gbombID,ip:c.initialProvider,p:c.platform,ib:w,si:h,ti:d,li:v,mp:c.metascorePage,ms:c.metascore,gs:c.gameStatus,ps:c.playStatus,ur:c.userRating};return n.extend(!0,E,l),a=n.ajax({url:p,type:"POST",data:E,dataType:"json",cache:!0,success:function(n){t.id=n.itemID,t.itemID=n.itemID;var o=z(t,n);f.updateInitialItemTags(n.tagIDsAdded,n.idsAdded);var u=[],a=" added to tag: ";r.each(e,function(e){u.push(f.getTagName(e))}),e.length>1&&(a=" added to tags: "),s.success(c.name+a+u.join(", ")),i(n,o)},error:u}),a},P=function(e,t,n){var r=0,i="";for(var s=0,o=e.length;s<o;s++){if(e[s]!==t[s]||e[s]!==n[s])break;r=s}return r+1},H=function(e,t){var n=e;return t===l.SEARCH_PROVIDERS.Amazon?n=e.replace(l.AMAZON_IMAGE.RE,l.AMAZON_IMAGE.TOKEN):t===l.SEARCH_PROVIDERS.GiantBomb&&(n=e.replace(l.GIANTBOMB_IMAGE.RE,l.GIANTBOMB_IMAGE.TOKEN)),n},B=function(e,t,n){var r=e,i=null;return e=t+e,n==l.SEARCH_PROVIDERS.Amazon?(i=new RegExp(l.AMAZON_IMAGE.TOKEN,"g"),r=e.replace(i,l.AMAZON_IMAGE.URL)):n==l.SEARCH_PROVIDERS.GiantBomb&&(i=new RegExp(l.GIANTBOMB_IMAGE.TOKEN,"g"),r=e.replace(i,l.GIANTBOMB_IMAGE.URL)),r},j=function(e,t,i,u,a){var l=o.getUserCredentials(!0),c={ids:e};n.extend(!0,c,l),n.ajax({url:d,type:"POST",data:c,dataType:"json",cache:!0,success:function(e){var n=[],o=" removed from tag: ";r.each(t,function(e){n.push(f.getTagName(e))}),t.length>1&&(o=" removed from tags: "),s.error(i.name+o+n.join(", "))},error:a}),F(i.itemID,e,t),u(i.itemID,t)},F=function(e,t,n){for(var r=0,i=t.length;r<i;r++)W(n[r],e)},I=function(e,t,r,i){var s=Y(e).tags[t],u=o.getUserCredentials(!0),a={id:s};return n.extend(!0,a,u),n.ajax({url:v,type:"POST",data:a,dataType:"json",cache:!0,success:function(e){},error:i}),W(t,e),r(s,t),e},q=function(e,t,r){var i=Y(e.itemID).tags,s=o.getUserCredentials(!0),u=n.extend(!0,{},e),a={id:u.itemID,aid:u.asin,gid:u.gbombID,rd:u.releaseDate,si:u.smallImage,ti:u.thumbnailImage,li:u.largeImage};n.extend(!0,a,s),n.ajax({url:g,type:"POST",data:a,dataType:"json",cache:!0,success:function(e){$(u,i),t(u,e)},error:r})},R=function(e,t,r){var i=o.getUserCredentials(!0),u=n.extend(!0,{},e),a={id:u.itemID,gs:u.gameStatus,ps:u.playStatus,ur:u.userRating};n.extend(!0,a,i),n.ajax({url:m,type:"POST",data:a,dataType:"json",cache:!0,success:function(e){V(u),t(u,e),s.success(u.name+" status updated")},error:r})},U=function(e,t,r){var i=Y(e.itemID).tags,s=o.getUserCredentials(!0),u=n.extend(!0,{},e),a={id:u.itemID,mp:u.metascorePage,ms:u.metascore};n.extend(!0,a,s),$(u,i),n.ajax({url:y,type:"POST",data:a,dataType:"json",cache:!0,success:function(e){t&&t(u,e)},error:r})},z=function(e,t){var i=null,s=null,o=[];e.itemID=t.itemID;for(var u=0,f=t.tagIDsAdded.length;u<f;u++)s=n.extend(!0,{},e),s.id=t.itemID,X(s),a.cacheItemByTag(t.tagIDsAdded[u],s),o.push(s);J(s,t),i=a.getCachedItemsByTag(w);var l=!1;return r.each(i,function(e,t){e.itemID===s.itemID&&(l=!0)}),l||a.cacheItemByTag(w,s),o},W=function(e,t){a.deleteCachedItem(t,e),K(t,e),S[t].tagCount===0&&a.deleteCachedItem(t,w)},X=function(e){e.releaseDate!=="1900-01-01"?e.calendarDate=i(e.releaseDate,"YYYY-MM-DD").calendar():e.calendarDate="Unknown",e.standardName=u.standardizeTitle(e.name)},V=function(e){var t=S[e.itemID];t.gameStatus=e.gameStatus,t.playStatus=e.playStatus,t.userRating=e.userRating,a.storeItemDirectory(S)},$=function(e,t){r.each(t,function(t,n){a.updateCacheItemByTag(n,e)}),a.updateCacheItemByTag(0,e)},J=function(e,t){if(!S[t.itemID]){var n={itemID:e.itemID,asin:e.asin,gbombID:e.gbombID,gameStatus:e.gameStatus,playStatus:e.playStatus,tags:{},tagCount:0,userRating:e.userRating};Q(n)}for(var r=0,i=t.tagIDsAdded.length;r<i;r++)S[t.itemID].tags[t.tagIDsAdded[r]]=t.idsAdded[r],S[t.itemID].tagCount+=1;a.storeItemDirectory(S)},K=function(e,t){var n=S[e];delete n.tags[t],n.tagCount+=-1,a.storeItemDirectory(S)},Q=function(e){S[e.itemID]=e,parseInt(e.asin,10)!==0&&(x[e.asin]=e),parseInt(e.gbombID,10)!==0&&(T[e.gbombID]=e)},G=function(){return S},Y=function(e){return S[e]||null},Z=function(e,t){var n=null;return e!==0?n=T[e]:t!==0&&(n=x[t]),n},et=function(){E={},S={},x={},T={},a.clearItemCache()},tt=function(){var e=[];r.each(E,function(t,n){e.push(n)});var t=Math.floor(Math.random()*e.length);return e[t]},nt=function(e,t,r){var i=o.getUserCredentials(!0),s={source:e,source_user:t};n.extend(!0,s,i),n.ajax({url:b,type:"POST",data:s,dataType:"json",cache:!0,success:r,error:function(e){}})},rt={init:N,itemsAndDirectoryLoaded:C,getItemDirectory:G,getDirectoryItemByItemID:Y,getItemByThirdPartyID:Z,resetItemData:et,getRandomItemID:tt,getItems:O,getItem:_,downloadItemDirectory:k,addItemToTags:D,updateUserItem:R,updateMetacritic:U,deleteTagsForItem:j,deleteSingleTagForItem:I,deleteTagFromDirectory:K,deleteClientItem:W,importGames:nt};n.extend(e,rt)}(tmz.module("itemData"),tmz,$,_,moment,alertify),function(e,t,n,r){"use strict";var i=t.api+"tag/",s=t.api+"tag/add/",o=t.api+"tag/update/",u=t.api+"tag/delete/",a=t.module("user"),f=t.module("storage"),l=t.module("itemData"),c={};e.getTags=function(e,t){var r=null,s=a.getUserCredentials(),o={};return n.extend(!0,o,s),c=f.get("tag"),c?e&&e(c):r=n.ajax({url:i,type:"POST",data:o,dataType:"json",cache:!0,success:function(t){c=f.set("tag",t.list),e(t.list)},error:t}),r},e.addTag=function(e,t,r){var i=a.getUserCredentials(!0),o={tag_name:e};n.extend(!0,o,i),n.ajax({url:s,type:"POST",data:o,dataType:"json",cache:!0,success:function(e){c.push({tagName:e.tagName.toLowerCase(),tagID:e.tagID}),f.set("tag",c),t(e)},error:r})},e.updateTag=function(e,t,r,i){var s=a.getUserCredentials(!0),u={tag_name:e,tag_id:t};n.extend(!0,u,s),n.ajax({url:o,type:"POST",data:u,dataType:"json",cache:!0,success:function(e){r(e)},error:i});for(var l=0,h=c.length;l<h;l++)c[l].tagID===t&&(c[l].tagName=e,f.set("tag",c))},e.deleteTag=function(e,t,r){var i=a.getUserCredentials(!0),s={id:e};n.extend(!0,s,i),n.ajax({url:u,type:"POST",data:s,dataType:"json",cache:!0,success:t,error:r});for(var o=0,l=c.length;o<l;o++)if(c[o].tagID===e){c.splice(o,1),f.set("tag",c);break}}}(tmz.module("tagData"),tmz,jQuery,_),function(e,t,n,r){"use strict";var i=t.module("user"),s=t.module("storage"),o=t.module("utilities"),u=o.VIEW_ALL_TAG_ID,a={},f={},l=function(e){var t=null;return typeof a[e]!="undefined"?t=a[e]:t=E(e),t},c=function(e,t){r.each(e,function(e,n){typeof t[e.itemID]!="undefined"&&r.each(t[e.itemID].tags,function(t,n){h(n,e),h(u,e)})})},h=function(e,t){typeof a[e]!="undefined"?a[e][t.itemID]=t:(a[e]={},a[e][t.itemID]=t),m(e,t)},p=function(e,t){a[e][t.itemID]=t,m(e,t,!0)},d=function(){return s.get("itemDataDirectory")},v=function(e){s.set("itemDataDirectory",e)},m=function(e,t,n){if(typeof f[e+"_"+t.itemID]=="undefined"||n){var r=s.get("itemsCacheByTag");r?typeof r[e]!="undefined"?r[e][t.itemID]=t:(r[e]={},r[e][t.itemID]=t):(r={},r[e]={},r[e][t.itemID]=t),s.set("itemsCacheByTag",r)}},g=function(e,t){a[t]&&delete a[t][e],w(e,t)},y=function(e){a[e]&&delete a[e],b(e)},b=function(e){var t=s.get("itemsCacheByTag");t&&(delete t[e],s.set("itemsCacheByTag",t))},w=function(e,t){var n=s.get("itemsCacheByTag");n&&(delete n[t][e],s.set("itemsCacheByTag",n))},E=function(e){var t=s.get("itemsCacheByTag"),n=null;return t&&typeof t[e]!="undefined"&&(n=t[e],r.each(n,function(t,n){f[e+"_"+n]=!0})),n},S=function(e){a={},f={}},x=function(e){s.remove("itemsCacheByTag"),s.remove("itemDataDirectory"),s.remove("tag")},T={getCachedItemsByTag:l,cacheItemsByTag:c,cacheItemByTag:h,updateCacheItemByTag:p,getStoredItemDirectory:d,storeItemDirectory:v,deleteCachedItem:g,deleteCachedTag:y,clearItemCache:S,clearStoredData:x};n.extend(e,T)}(tmz.module("itemCache"),tmz,$,_),function(e,t,n,r,i){"use strict";var s=t.module("user"),o=t.module("itemData"),u=t.module("tagView"),a=t.module("itemView"),f=t.module("searchView"),l=t.module("storage"),c={login:0,signup:1},h=900,p=c.login,d=!1,v=1,m=n("#content"),g=n("#infoHeader"),y=n("#header"),b=n("#userMenu"),w=n("#loggedInButton"),E=n("#managementButton"),S=n("#updateProfileButton"),x=n("#changePasswordButton"),T=n("#logoutButton"),N=n("#loginForm"),C=n("#buttonContainer"),k=n("#loginButton"),L=n("#loginHitArea"),A=n("#signupButton"),O=n("#signupHitArea"),M=n("#loginSubmitButton"),_=n("#signupSubmitButton"),D=n("#backButton"),P=n("#email").find("input"),H=n("#password").find("input"),B=n("#rememberCheckboxToggle"),j=n("#resetPasswordButton"),F=n("#invalidLoginTag"),I=n("#accountExistsTag"),q=n("#accountManagement-modal"),R=n("#updateProfile-modal"),U=n("#changePassword-modal"),z=n("#clearLocalStorage_btn"),W=n("#deleteAccount_btn"),X=R.find(".usernameGroup"),V=R.find("#userNameUpdateField"),$=R.find(".emailGroup"),J=R.find("#emailUpdateField"),K=R.find(".existingPasswordGroup"),Q=R.find(".alert-success"),G=R.find(".alert-error"),Y=R.find("#updateAccount_btn"),Z=U.find("#passwordUpdateField"),et=U.find("#passwordConfirmField"),tt=U.find(".existingPasswordGroup"),nt=U.find("#passwordField"),rt=U.find("#changePassword_btn"),it=n("#resetpassword-modal"),st=it.find(".resetCodeForm"),ot=it.find(".updatePasswordForm"),ut=it.find(".passwordResetCodeContainer"),at=it.find(".passwordResetEmailContainer"),ft=it.find(".alert-success"),lt=it.find(".alert-error"),ct=n("#resetPasswordEmailField"),ht=n("#resetPasswordCodeField"),pt=n("#resetPasswordPasswordField"),dt=n("#sendResetCode_btn"),vt=n("#submitResetCode_btn"),mt=n("#updatePassword_btn"),gt=n("#guideHitArea"),yt=n("#guideButton"),bt=n("#siteGuide"),wt=n("#siteGuideBackdrop"),Et=bt.find(".siteGuideExit_btn"),St=bt.find(".siteGuidePrevious_btn"),xt=bt.find(".siteGuideNext_btn"),Tt=n("#searchField input"),Nt=n("#itemResultsContainer").find(".loadingStatus"),Ct=function(){kt(),Lt(),it.modal({backdrop:!0,keyboard:!0,show:!1});var e=window.location.pathname.split("/"),t=e[1],n=e[2];t=="user"&&n!==""?s.validateUser(n,function(e){e.status==="success"&&Dt()}):_t()},kt=function(){E.click(function(e){e.preventDefault(),nn()}),Y.click(function(e){e.preventDefault(),rn()}),x.click(function(e){e.preventDefault()}),P.on("keydown",function(e){tn(e.which)}),H.on("keydown",function(e){tn(e.which)}),T.click(function(e){e.preventDefault(),Ht()}),z.click(function(e){e.preventDefault(),l.clearStorage()}),W.click(function(e){e.preventDefault(),sn()}),O.click(function(e){e.preventDefault(),Gt()}),O.mouseover(function(e){A.addClass("hover")}),O.mouseout(function(e){A.removeClass()}),O.mousedown(function(e){A.addClass("active")}),O.mouseup(function(e){A.removeClass("active")}),L.click(function(e){e.preventDefault(),Qt()}),L.mouseover(function(e){k.addClass("hover")}),L.mouseout(function(e){k.removeClass()}),L.mousedown(function(e){k.addClass("active")}),L.mouseup(function(e){k.removeClass("active")}),gt.click(function(e){It()}),gt.mouseover(function(e){yt.addClass("hover")}),gt.mouseout(function(e){yt.removeClass()}),gt.mousedown(function(e){yt.addClass("active")}),gt.mouseup(function(e){yt.removeClass("active")}),M.click(function(e){e.preventDefault(),Ot(P.val(),H.val())}),_.click(function(e){e.preventDefault(),Bt(P.val(),H.val())}),D.click(function(e){e.preventDefault(),en()}),B.click(function(e){d?(d=!1,n(this).removeClass("on"),At()):(d=!0,n(this).addClass("on"))}),j.click(function(e){e.preventDefault();var t=P.val()||l.getGlobal("email");t&&ct.val(t),it.modal("show"),r.delay(function(){ct.focus().select()},1e3)}),dt.click(function(e){e.preventDefault(),Rt(ct.val())}),vt.click(function(e){e.preventDefault(),zt(ct.val(),ht.val())}),mt.click(function(e){e.preventDefault(),Xt(ct.val(),ht.val(),pt.val())}),ct.keydown(function(e){e.which===13&&(e.preventDefault(),Rt(ct.val()))}),ht.keydown(function(e){e.which===13&&(e.preventDefault(),zt(ct.val(),ht.val()))}),pt.keydown(function(e){e.which===13&&(e.preventDefault(),Xt(ct.val(),ht.val(),pt.val()))}),bt.click(function(e){e.preventDefault(),e.stopPropagation()}),xt.click(function(e){e.preventDefault(),It(++v)}),St.click(function(e){e.preventDefault(),It(--v)}),Et.click(function(e){e.preventDefault(),v=1,It(v),qt()})},Lt=function(){var e=l.getGlobal("email");e&&(d=!0,P.val(e),B.addClass("on"),H.focus())},At=function(){d?l.setGlobal("email",P.val()):l.removeGlobal("email")},Ot=function(e,t){Mt(),s.login(e,t,jt)},Mt=function(){H.val(""),F.hide(),I.hide()},_t=function(){s.demoLogin(),Pt()},Dt=function(){Pt()},Pt=function(){window.setTimeout(function(){Nt.fadeIn(),Tt.focus(),a.clearItemView(),o.resetItemData();var e=null,t=null,r=o.downloadItemDirectory(),i=a.initializeUserItems(function(t){e=t},function(){e={}}),s=u.getTags(function(e){t=e},function(){});n.when(i,r,s).then(function(){u.getTags_result(t),a.initializeUserItems_result(e),Nt.hide()},function(){})},h)},Ht=function(){Kt(),a.clearItemView(),s.logout(),_t()},Bt=function(e,t){Mt(),e!==""&&t!==""&&s.createUser(e,t,Ft)},jt=function(e,t){e.status==="success"?(At(),Jt(t),Pt()):typeof e.status!="undefined"&&e.status==="invalid_login"&&(i.error("Login Failed: "+t),F.fadeIn())},Ft=function(e,t){typeof e.status!="undefined"&&e.status==="user_exists"?I.fadeIn():(At(),jt(e,t))},It=function(e){e&&(m.removeClass(),m.addClass("step"+e)),bt.is(":visible")||bt.show()},qt=function(){bt.is(":visible")&&bt.hide()},Rt=function(e){s.sendResetPasswordCode(e,Ut)},Ut=function(e){typeof e.status!="undefined"&&e.status==="success"?(dt.hide(),vt.show(),at.hide(),ut.show(),ft.find(".alertTitle").text("E-mail sent:"),ft.show().find(".alertText").html("Check your e-mail and enter the <strong>3-digit code</strong> into the field above"),lt.hide()):typeof e.status!="undefined"&&e.status==="invalid_email"&&(lt.find(".alertTitle").text("Invalid E-mail address:"),lt.show().find(".alertText").html("Cannot send password reset code"))},zt=function(e,t){s.submitResetPasswordCode(e,t,Wt)},Wt=function(e){typeof e.status!="undefined"&&e.status==="success"?(st.hide(),vt.hide(),ot.show(),mt.show(),ft.hide(),lt.hide()):(ft.hide(),lt.find(".alertTitle").text("Invalid code:"),lt.show().find(".alertText").html("Reset code is incorrect, please try again"))},Xt=function(e,t,n){s.updatePassword(e,t,n,function(t){Vt(t,e,n)})},Vt=function(e,t,n){typeof e.status!="undefined"&&e.status==="success"&&($t(),P.val(t),H.val(n),Ot(P.val(),H.val()))},$t=function(){it.modal("hide"),dt.show(),vt.hide(),mt.hide(),st.show(),ot.hide(),at.show(),ut.hide(),ft.hide(),lt.hide(),ct.val(""),ht.val(""),pt.val("")},Jt=function(e){n("body").removeClass("infoHeader"),n("body").addClass("useHeader"),w.find(".userEmail").text(e),a.loggedInView(!0),f.loggedInView(!0),b.show()},Kt=function(){n("body").removeClass("useHeader"),n("body").addClass("infoHeader"),a.loggedInView(!1),f.loggedInView(!1),b.hide()},Qt=function(){p=c.login,Zt(),M.show(),_.hide(),D.removeClass("signup"),D.addClass("login")},Gt=function(){p=c.signup,Zt(),_.show(),M.hide(),D.removeClass("login"),D.addClass("signup")},Yt=function(){},Zt=function(){Mt(),N.show(),D.show(),d&&P.val()!==""?H.focus():P.focus(),C.hide()},en=function(){N.hide(),M.hide(),_.hide(),D.hide(),C.show()},tn=function(e){e===13&&p===c.login?Ot(P.val(),H.val()):e===13&&p===c.signup&&Bt(P.val(),H.val())},nn=function(e){on();var t=s.getUserData();V.val(t.userName),J.val(t.email),R.modal("show")},rn=function(){on();var e=nt.val(),t=J.val();if(e!==""&&t!==""){var n=V.val(),r=Z.val();s.updateUser(e,t,n,r,function(e){e.status==="success"?(w.find(".userEmail").text(t),Z.val(""),nt.val(""),Q.fadeIn().find(".alertText").text("Account updated")):e.status==="incorrect_password"?(K.addClass("error"),G.fadeIn().find(".alertText").text("Incorrect password"),nt.val("")):e.status==="username_exists"&&(X.addClass("error"),G.fadeIn().find(".alertText").text("User name exists"))})}e===""&&(K.addClass("error"),G.fadeIn().find(".alertText").text("Please enter existing password")),t===""&&($.addClass("error"),G.fadeIn().find(".alertText").text("E-mail cannot be blank")),Z.val("")},sn=function(){},on=function(){Q.hide(),G.hide(),K.removeClass("error"),$.removeClass("error"),V.removeClass("error")},un={init:Ct,hideSiteGuide:qt};n.extend(e,un)}(tmz.module("siteView"),tmz,jQuery,_,alertify),function(e,t,n,r,i,s){"use strict";var o=t.module("detailView"),u=t.module("amazon"),a=t.module("giantbomb"),f=t.module("utilities"),l=t.module("gameStats"),c=t.module("ign"),h=t.module("releasedList"),p=t.module("itemLinker"),d={POPULAR:0,UPCOMING:1,RELEASED:2},v={"#searchTab":0,"#listTab":1},m=400,g={List:0,Icons:1,Cover:2},y=258,b=503,w=5,E=13,S=null,x="skyrim",T="",N={},C=[],k=null,L=v["#searchTab"],A=0,O=0,M=null,_=null,D=g.Icons,P=g.Icons,H=b,B=!1,j=null,F={valueNames:["itemName","releaseDate"],item:"list-item"},I=n("#searchContainer"),q=n("#searchViewMenu"),R=n("#listType"),U=R.find(".listTypeName"),z=n("#searchPlatforms"),W=n("#legacySubNav"),X=n("#platformSelect_btn"),V=n("#listPlatforms"),$=n("#listPlatforms").find("ul"),J=z.find(".platformName"),K=V.find(".platformName"),Q=n("#finderTabLinks"),G=n("#finderTabContent"),Y=n("#searchTab"),Z=n("#listTab"),et=n("#searchTabLink"),tt=n("#listTabLink"),nt=n("#searchField"),rt=n("#search_btn"),it=n("#clearSearch_btn"),st=it.find("i"),ot=n("#searchResultsContainer"),ut=ot.find(".content"),at=n("#searchResults"),ft=nt.find("input"),lt=n("#listResultsContainer"),ct=lt.find(".content"),ht=n("#listResults"),pt=ht.find(".list"),dt=I.find(".searchDisplayOptions"),vt=I.find(".listDisplayOptions"),mt=ot.find(".loadingStatus"),gt=lt.find(".loadingStatus"),yt=r.template(n("#search-results-template").html()),bt=r.template(n("#list-results-template").html()),wt=r.template(n("#list-platform-template").html()),Et=r.template(n("#search-results-platform-dropdown-template").html());e.init=function(t){e.createEventHandlers(),Nt(),M=f.PLATFORM_INDEX[0],_=f.getStandardPlatform(""),Xt(!1),vt.find("button").each(function(e,t){n(t).tooltip({delay:{show:500,hide:50},placement:"bottom"})}),dt.find("button").each(function(e,t){n(t).tooltip({delay:{show:500,hide:50},placement:"bottom"})});var r={sliderMinHeight:20,iOSNativeScrolling:!0,preventPageScrolling:!0};ot.nanoScroller(r),lt.nanoScroller(r),setInterval(function(){Vt(),ot.nanoScroller(),lt.nanoScroller()},1500),W.BootstrapSubMenu({$mainNav:z})},e.createEventHandlers=function(){Q.find('a[data-toggle="tab"]').on("shown",function(e){L=v[n(e.target).attr("href")],Mt(L)}),ft.keyup(Rt),q.on("mouseenter",".dropdown-toggle",function(e){var t=this;q.find(".dropdown").each(function(){n(this).hasClass("open")&&n(this).find(".dropdown-toggle").get(0)!==n(t).get(0)&&n(t).trigger("click")})}),R.find("li a").click(function(e){e.preventDefault(),R.attr("data-content",n(this).attr("data-content")),_t()}),V.on("click","li a",function(e){e.preventDefault(),n(this).attr("data-content")&&Dt(n(this).attr("data-content"),n(this).text())}),z.find("li:not(.dropdown-sub) a").click(function(e){e.preventDefault(),Pt(n(this).attr("data-content"),n(this).text())}),at.on("click","tr",Ut),ht.on("click","tr",zt),at.on("click",".dropdown-menu li",function(e){e.preventDefault(),Wt(this)}),dt.on("click","button",function(e){e.preventDefault(),It(n(this).attr("data-content"),!1,n(this))}),vt.on("click","button",function(e){e.preventDefault(),(k==d.UPCOMING||k==d.RELEASED)&&It(n(this).attr("data-content"),!1,n(this))}),rt.click(function(t){t.preventDefault(),e.search(x)}),it.click(function(e){ft.val(""),ft.focus(),Xt(!1)}),at.resize(e.resizePanel),ht.resize(e.resizePanel),n(window).resize(e.resizePanel)},e.renderSearchResults=function(e){mt.stop().hide(),r.each(e,function(e,t){C.push(e)}),C.sort(Ot);var t={sortedSearchResults:C};t.displayType=D,at.html(yt(t))},e.renderListResults=function(e,t){gt.stop().hide();var n={listResults:e};pt.append(bt(n)),xt(t)},e.search=function(e){St(),e===""?Xt(!1):Xt(!0),L!==v["#searchTab"]&&(et.trigger("click"),Mt(v["#searchTab"])),e!==T&&(ot.find(".noResults").hide(),mt.fadeIn(),T=e,u.searchAmazon(e,M.amazon,function(t){Ct(t,e)}),a.searchGiantBomb(e,function(t){kt(t,e)}))},e.getGamestatsPopularityListByPlatform=function(e){function t(e){Tt(e,"desc",d.POPULAR)}gt.fadeIn(),pt.empty(),l.getPopularGamesListByPlatform(e.gamestats,t)},e.getIGNUpcomingListByPlatform=function(e){function t(e){Tt(e,"asc",d.UPCOMING)}gt.fadeIn(),pt.empty(),c.getUpcomingGames(e.ign,0,t),c.getUpcomingGames(e.ign,1,t)},e.getReleasedList=function(e){function u(e,t){Tt(e,"desc",d.RELEASED,t)}var t=14;gt.fadeIn(),pt.empty();var n=i().day(0),r=n;for(var s=0,o=t;s<o;s++)h.getReleasedGames(e.id,r.year(),r.month()+1,r.date(),u),r=r.subtract("weeks",1)},e.resizePanel=function(){var e=null,t=null;switch(L){case v["#searchTab"]:e=at.height(),t=ot,mt.is(":visible")&&(e+=mt.height());break;case v["#listTab"]:e=ht.height(),gt.is(":visible")&&(e+=gt.height()),t=lt}var r=n(window).height();if(e<r-H)t.css({height:e+w});else{var i=r-H;t.css({height:i+E})}},e.loggedInView=function(e){e?H=y:H=b};var St=function(){at.empty(),mt.fadeIn(),N={},C=[]},xt=function(e){j=new s("listResults",F),e==="asc"?j.sort("releaseDate",{sortFunction:$t}):j.sort("releaseDate",{sortFunction:Jt})},Tt=function(t,n,r,i){i=typeof i!="undefined"?i:null,i&&Nt(i),r===k&&e.renderListResults(t,n)},Nt=function(e){var t={};typeof e!="undefined"&&e?r.each(e,function(e,n){t[n]="("+e+") "}):t={all:"",pc:"",x360:"",xbl:"",ps3:"",psn:"",vita:"",ds:"","3ds":"",wii:"",wiiu:""},$.html(wt({found:t}))},Ct=function(t,r){var i=!1,s={},o={};n("Item",t).each(function(){o=u.parseAmazonResultItem(n(this)),typeof o.isFiltered=="undefined"&&(s[o.id]=o)}),n.extend(!0,N,s),console.info(x,r),x===r&&e.renderSearchResults(N)},kt=function(t,r){var i=t.results,s={},o={};for(var u=0,f=i.length;u<f;u++)o=a.parseGiantBombResultItem(i[u]),a.getGiantBombItemPlatform(o.gbombID,Lt),s[o.id]=o;n.extend(!0,N,s),console.info(x,r),x===r&&e.renderSearchResults(N)},Lt=function(t,n){var r=t.results.platforms,i=[],s="";for(var o=0,u=r.length;o<u;o++)s=f.matchPlatformToIndex(r[o].name).name||r[o].name,i.push(s);At(n,i);var a=e.getSearchResult(n);a&&(a.platformList=i,a.platform=i[0])},At=function(e,t){var r={platformList:t,gbombID:e};n("#"+e).find(".platformDropdown").html(Et(r))},Ot=function(e,t){var n=Date.parse(e.releaseDate),r=Date.parse(t.releaseDate);return r-n};e.getSearchResult=function(e){return N[e]};var Mt=function(e){switch(e){case 0:ot.nanoScroller({scrollTop:A-1}),jt(!0),Ft(!1);break;case 1:lt.nanoScroller({scrollTop:parseInt(O-1,10)}),Ft(!0),jt(!1),_t()}},_t=function(){var e=parseInt(R.attr("data-content"),10);if(e!==k){switch(e){case 0:It(0,!0),vt.fadeTo(100,.35),U.text("Popular"),k=d.POPULAR;break;case 1:It(P),vt.find("button:eq("+P+")").button("toggle"),vt.fadeTo(100,1),U.text("Upcoming"),k=d.UPCOMING;break;case 2:It(P),vt.find("button:eq("+P+")").button("toggle"),vt.fadeTo(100,1),U.text("Released"),k=d.RELEASED}Bt(k)}},Dt=function(e,t){K.text(t),_=f.getStandardPlatform(e),Bt(k)},Pt=function(t,n){T="",J.text(n),M=f.getStandardPlatform(t),e.search(x)},Ht=function(e){switch(e){case 0:et.tab("show");break;case 1:tt.tab("show")}},Bt=function(t){function n(){K.text(K.text().split(" (")[0])}Nt();switch(t){case d.POPULAR:n(),e.getGamestatsPopularityListByPlatform(_);break;case d.UPCOMING:n(),e.getIGNUpcomingListByPlatform(_);break;case d.RELEASED:e.getReleasedList(_)}},jt=function(e){e?(dt.show(),z.show()):(dt.hide(),z.hide())},Ft=function(e){e?(vt.show(),V.show(),R.show()):(vt.hide(),V.hide(),R.hide())},It=function(e,t,n){t=typeof t!="undefined"?t:!1,n&&n.addClass("active").siblings().removeClass("active"),L===v["#searchTab"]?(D=e,at.find("tbody").removeClass().addClass("display-"+e)):ht.find("tbody").hasClass("display-"+e)===!1&&(t||(P=e),lt.find(".content").removeClass("display-0").removeClass("display-1").removeClass("display-2").addClass("display-"+e))},qt=function(){clearTimeout(S),e.search(x)},Rt=function(t){x=ft.val(),St(),S&&clearTimeout(S),t.which==13?e.search(x):S=setTimeout(qt,m)},Ut=function(){var t=e.getSearchResult(n(this).attr("id"));o.viewFirstSearchItemDetail(t)},zt=function(){Vt(),x=p.standardizeTitle(n(this).find(".itemName").text()),Ht(v["#searchTab"]),ft.val(x),Pt(_.id,_.name),e.search(x)},Wt=function(t){var r=e.getSearchResult(n(t).attr("data-content"));r.platform=n(t).find("a").text(),n(t).parent().siblings(".dropdown-toggle").html(r.platform).append('<b class="caret"></b>')},Xt=function(e){e?(st.show(),it.addClass("hover")):(st.hide(),it.removeClass("hover"))},Vt=function(){L===v["#searchTab"]?A=ut.scrollTop()||1:L===v["#listTab"]&&(O=ct.scrollTop()||1)},$t=function(e,t){var r=n(e.elm).find(".releaseDate"),i=n(t.elm).find(".releaseDate"),s=Date.parse(r.text()),o=Date.parse(i.text());return s-o},Jt=function(e,t){var r=n(e.elm).find(".releaseDate"),i=n(t.elm).find(".releaseDate"),s=Date.parse(r.text()),o=Date.parse(i.text());return o-s}}(tmz.module("searchView"),tmz,jQuery,_,moment,List),function(e,t,n,r,i){var s=t.module("user"),o=t.module("tagView"),u=t.module("utilities"),a=t.module("searchView"),f=t.module("itemView"),l=t.module("itemData"),c=t.module("amazon"),h=t.module("itemLinker"),p=t.module("metacritic"),d=t.module("giantbomb"),v=t.module("wikipedia"),m=t.module("gameTrailers"),g=t.module("steam"),y=t.module("videoPanel"),b=["#amazonTab","#giantBombTab"],w={0:"None",1:"Own",2:"Sold",3:"Wanted"},E={0:"Not Started",1:"Playing",2:"Played",3:"Finished"},S={NEW:0,EXISTING:1},x=!1,T=null,N=b[0],C=null,k=!1,L=S.NEW,A=null,O={},M={},_={},D=null,P=null,H=n("#detailTabContent"),B=n("#amazonTab"),j=n("#giantBombTab"),F=n("#amazonTabLink"),I=n("#giantBombTabLink"),q=B.find(".itemDetailThumbnail"),R=j.find(".itemDetailThumbnail"),U=q.find(".itemDetailInfo"),z=R.find(".itemDetailInfo"),W=H.find(".showVideo_btn"),X=H.find(".showDiscussion_btn"),V=n("#detailContainer"),$=n("#addListContainer"),J=n("#addList"),K=n("#saveItem_btn"),Q=n("#addItem_btn"),G=n("#itemAttributes"),Y=n("#platform"),Z=n("#releaseDate"),et=n("#wikipediaPage"),tt=n("#gametrailersPage"),nt=n("#giantBombPage"),rt=n("#metacriticPage"),it=G.find("#priceHeader"),st=G.find("#amazonPriceNew"),ot=G.find("#amazonPriceUsed"),ut=G.find("#steamPrice"),at=n("#gameStatus"),ft=n("#playStatus"),lt=n("#userRating"),ct=n("#ratingCaption"),ht=r.template(n("#description-modal-template").html());e.init=function(){e.createEventHandlers(),K.hide(),G.hide(),_t(),lt.stars({split:2,captionEl:ct,callback:function(e,t,n){O.userRating=n,Rt(O)}})},e.createEventHandlers=function(){F.click(function(e){e.preventDefault(),e.stopPropagation(),Mt(u.SEARCH_PROVIDERS.Amazon)}),I.click(function(e){e.preventDefault(),e.stopPropagation(),Mt(u.SEARCH_PROVIDERS.GiantBomb)}),W.click(function(e){e.preventDefault(),k&&y.showVideoPanel()}),X.click(function(e){e.preventDefault(),yt()}),q.click(function(e){}),R.click(function(e){}),K.click(function(e){e.preventDefault(),It(O)}),Q.click(function(e){e.preventDefault(),It(O)}),at.find("li a").click(function(e){e.preventDefault(),O.gameStatus=n(this).attr("data-content"),at.find(".currentSelection").text(w[O.gameStatus]),Rt(O)}),ft.find("li a").click(function(e){e.preventDefault(),O.playStatus=n(this).attr("data-content"),ft.find(".currentSelection").text(E[O.playStatus]),Rt(O)}),n('#detailTab a[data-toggle="tab"]').on("shown",function(e){N=n(e.target).attr("href")}),J.change(Vt)},e.viewFirstSearchItemDetail=function(e){if(e.id!==O.id||e.platform!==O.platform)Ot(),_t(),O=n.extend(!0,{},e),T=Pt(O.asin,O.gbombID),O.initialProvider=T,O.standardName=h.standardizeTitle(O.name),_=l.getItemByThirdPartyID(O.gbombID,O.asin),C=O.id,Dt(T),Mt(T),h.findItemOnAlternateProvider(O,T,!0,function(e){return function(t){dt(t,e)}}(C),function(){}),Bt(O,_),jt(O,_),pt(O,!0),vt(O,T,0)},e.viewItemDetail=function(t){Ot(),_t(),Ht(S.EXISTING),O=n.extend(!0,{},t),O.standardName=h.standardizeTitle(O.name),T=parseInt(O.initialProvider,10),_=l.getDirectoryItemByItemID(O.itemID),C=O.id,Dt(T),Mt(T),h.getLinkedItemData(O,T,e.viewSecondItemDetail),o.selectTagsFromDirectory(_.tags),jt(O,_),pt(O,!1),mt(O,T,0,t)},e.viewSecondItemDetail=function(e){M=n.extend(!0,{},e);var t=null;if(O.asin==M.asin||O.gbombID==M.gbombID)t=Pt(M.asin,M.gbombID),mt(M,t,1)},e.resetDetail=function(e){o.resetAddList(),Ht(S.NEW)},e.getViewingItemID=function(){return O.id};var pt=function(e,t){v.getWikipediaPage(e.standardName,e,xt),St(e.standardName,e,t),m.getGametrailersPage(e.standardName,e,Tt),g.getSteamGame(e.standardName,e,Nt)},dt=function(e,t){var r=n.extend(!0,{},e);if(C===t){var i=Pt(r.asin,r.gbombID);switch(i){case u.SEARCH_PROVIDERS.Amazon:O.asin=r.asin;break;case u.SEARCH_PROVIDERS.GiantBomb:O.gbombID=r.gbombID}vt(r,i,1)}},vt=function(e,t,n){wt(t,e),bt(e,n),Ct(t,O)},mt=function(e,t,n,r){wt(t,e),bt(O,n),Ct(t,O)},gt=function(e,t){t.find(".itemDetailTitle h3").text(e.name),t.find("img").attr("src",e.largeImage)},yt=function(){f.viewDiscussion();var e=O.standardName;DISQUS.reset({reload:!0,config:function(){this.page.identifier=e,this.page.url="http://www.gamedex.net/#!"+e}})},bt=function(e,t){G.is(":visible")||G.fadeIn(),(e.platform!=="n/a"||t===0)&&Y.find(".data").text(e.platform);if(e.releaseDate!=="1900-01-01"){if(t===0||O.releaseDate==="1900-01-01")O.releaseDate=e.releaseDate,O.calendarDate=i(e.releaseDate,"YYYY-MM-DD").calendar(),Z.find(".data").text(O.calendarDate)}else O.releaseDate==="1900-01-01"&&Z.find(".data").text("unknown")},wt=function(e,t){x||(n("#dataTab").show(),n(".detailTitleBar").show(),x=!0);switch(e){case u.SEARCH_PROVIDERS.Amazon:gt(t,B);break;case u.SEARCH_PROVIDERS.GiantBomb:gt(t,j)}},Et=function(e){e.find(".itemDetailTitle h3").text("No Match found"),e.find("img").attr("src","http://d2sifwlm28j6up.cloudfront.net/no_selection_placeholder.png")},St=function(e,t,r){function u(e){if(C===e.id||C===e.asin||C===e.gbombID)for(var t=0,n=b.length;t<n;t++)i=b[t]+" .metascore",p.displayMetascoreData(e.metascorePage,e.metascore,i),rt.show(),rt.find("a").attr("href","http://www.metacritic.com"+e.metascorePage)}var i="";for(var s=0,o=b.length;s<o;s++)i=b[s]+" .metascore",n(i).hide();D=p.getMetascore(e,t,r,u)},xt=function(e){et.show(),et.find("a").attr("href",e)},Tt=function(e){tt.show(),tt.find("a").attr("href",e)},Nt=function(e){e.steamPrice!==""?(it.show(),ut.find(".data").text(e.steamPrice),ut.find("a").attr("href",e.steamPage),ut.show()):ut.hide()},Ct=function(e,t){switch(e){case u.SEARCH_PROVIDERS.Amazon:c.getAmazonItemOffers(t.asin,t,kt);break;case u.SEARCH_PROVIDERS.GiantBomb:d.getGiantBombItemData(t.gbombID,Lt)}},kt=function(e){(e.buyNowPrice!==""||e.lowestUsedPrice!=="")&&it.show(),e.buyNowPrice!==""?(st.find("a").attr("href",e.productURL),st.find(".data").text(e.buyNowPrice),st.show()):st.hide(),e.lowestUsedPrice!==""?(ot.find(".data").text(e.lowestUsedPrice),ot.find("a").attr("href",e.offersURLUsed),ot.show()):ot.hide()},Lt=function(e){nt.show(),nt.find("a").attr("href",e.site_detail_url),At(e.videos,O.name)},At=function(e,t){e.length!==0&&(y.renderVideoModal(e,t),k=!0,W.removeClass("noVideos"),W.find("span").text("Show Videos"))},Ot=function(e){k=!1,W.addClass("noVideos"),W.find("span").text("No Videos")},Mt=function(e){switch(e){case u.SEARCH_PROVIDERS.Amazon:U.append(V),F.tab("show");break;case u.SEARCH_PROVIDERS.GiantBomb:z.append(V),I.tab("show")}},_t=function(){et.hide(),nt.hide(),rt.hide(),it.hide(),st.hide(),ot.hide(),ut.hide()},Dt=function(e){switch(e){case u.SEARCH_PROVIDERS.Amazon:Et(j);break;case u.SEARCH_PROVIDERS.GiantBomb:Et(B)}},Pt=function(e,t){var n=null;return e!==0?n=u.SEARCH_PROVIDERS.Amazon:t!==0&&(n=u.SEARCH_PROVIDERS.GiantBomb),n},Ht=function(e){e===S.EXISTING?(L=S.EXISTING,Q.hide(),K.hide()):e===S.NEW&&(L=S.NEW,K.hide(),Q.show())},Bt=function(e,t){t&&t.tagCount>0?(Ht(S.EXISTING),e.itemID=t.itemID,o.selectTagsFromDirectory(t.tags)):(Ht(S.NEW),o.selectUserTags())},jt=function(e,t){t?(e.gameStatus=t.gameStatus,e.playStatus=t.playStatus,e.userRating=t.userRating):(e.gameStatus="0",e.playStatus="0",e.userRating="0"),Ft(e)},Ft=function(e){at.find(".currentSelection").text(w[e.gameStatus]),ft.find(".currentSelection").text(E[e.playStatus]),lt.stars("select",e.userRating),ct.text(e.userRating/2),at.find(".currentSelection").attr("data-initial",e.gameStatus),ft.find(".currentSelection").attr("data-initial",e.playStatus),lt.attr("data-initial",e.userRating)},It=function(e){var t=o.getTagsToAdd(),n=o.getTagsToDelete(),r=n.idsToDelete,i=n.tagsToDelete;t.length>0&&(P=l.addItemToTags(t,e,zt)),r.length>0&&l.deleteTagsForItem(r,i,e,Wt),qt(e),$t()},qt=function(e){(r.isUndefined(e.metascore)||e.metascore===null)&&n.when(D,P).then(function(){l.updateMetacritic(O),f.refreshView()},function(){}),(T!==u.SEARCH_PROVIDERS.Amazon||e.gbombID!==0)&&T===u.SEARCH_PROVIDERS.Amazon&&e.asin===0},Rt=function(e){Xt()&&L===S.EXISTING&&l.updateUserItem(e,Ut)},Ut=function(e,t){t.status==="success"&&(Ft(e),f.updateListAttributesChanged(e))},zt=function(e,t){L!==S.EXISTING&&Ht(S.EXISTING),f.updateListAdditions(e,t)},Wt=function(e,t){f.updateListDeletions(e,t)},Xt=function(){var e=at.find(".currentSelection").attr("data-initial"),t=ft.find(".currentSelection").attr("data-initial"),n=lt.attr("data-initial");return e!==O.gameStatus||t!==O.playStatus||n!==O.userRating?!0:!1},Vt=function(e){x&&!e.reset&&(L===S.NEW&&o.updateUserTags(),$t())},$t=function(){L===S.EXISTING&&o.isAddListChanged()?K.fadeIn():K.fadeOut()}}(tmz.module("detailView"),tmz,jQuery,_,moment),function(e,t,n,r,i){"use strict";var s=t.module("user"),o=t.module("siteView"),u=t.module("tagView"),a=t.module("utilities"),f=t.module("detailView"),l=t.module("importView"),c=t.module("gridView"),h=t.module("itemData"),p=t.module("itemCache"),d=t.module("tagData"),v=t.module("amazon"),m=t.module("metacritic"),g=t.module("itemLinker"),y=t.module("filterPanel"),b=t.module("giantbomb"),w={List:0,Icons:1},E={collection:"collection",discussion:"discussion"},S={alphabetical:0,metascore:1,releaseDate:2,platform:3,price:4},x=230,T=460,N=10,C=50,k=5,L=10,A="0",O="View All",M=null,_={valueNames:["itemName","metascore","releaseDate","platform","gameStatus","playStatus","userRating"],item:"list-item"},D=A,P=w.Icons,H=0,B=!1,j=!1,F=null,I=!1,q=T,R=!1,U=E.collection,z=n("#wrapper"),W=n("#itemResults"),X=n("#resizeContainer"),V=n("#viewItemsContainer"),$=n("#itemResultsContainer"),J=V.find(".displayOptions"),K=n("#gridView_btn"),Q=n("#showCollection_btn"),G=n("#viewList"),Y=G.find(".viewName"),Z=n("#itemViewMenu"),et=n("#editMenu"),tt=V.find(".sortOptions"),nt=tt.find(".sortType"),rt=V.find(".filterOptions"),it=n("#platformFilterSubNav"),st=rt.find(".clearFilters_btn"),ot=rt.find(".filterDropDown_btn"),ut=rt.find(".filterType"),at=n("#applyFilters_btn"),ft=n("#deleteListConfirm-modal"),lt=n("#deleteListConfirm_btn"),ct=n("#deleteList_btn"),ht=ct.find(".listName"),pt=n("#importMenu"),dt=n("#error-modal"),vt=n("#updateList-modal"),mt=n("#tagNameField"),gt=n("#updateListConfirm_btn"),yt=n("#editList_btn"),bt=$.find(".loadingStatus"),wt=null,Et=r.template(n("#price-menu-template").html()),St=r.template(n("#item-results-template").html());e.init=function(){e.createEventHandlers(),ot.tooltip({delay:{show:500,hide:50}}),J.find("button").each(function(e,t){n(t).tooltip({delay:{show:500,hide:50},placement:"bottom"})});var t={sliderMinHeight:20,iOSNativeScrolling:!0,preventPageScrolling:!0,flash:!0,flashDelay:1500};$.nanoScroller(t),setInterval(function(){$.nanoScroller()},1500),zt(!1),it.BootstrapSubMenu({$mainNav:rt})},e.createEventHandlers=function(){Z.on("mouseenter",".dropdown-toggle",function(e){var t=this;Z.find(".dropdown").each(function(){n(this).hasClass("open")&&n(this).find(".dropdown-toggle").get(0)!==n(t).get(0)&&n(t).trigger("click")})}),G.find("ul").on("click","a",function(e){e.preventDefault(),Nt(n(this).attr("data-content"))}),at.click(function(e){e.preventDefault(),z.hasClass("gridView")||(zt(!0),Ut(0))}),st.click(function(e){e.preventDefault(),zt(!1),ut.text("None"),y.resetFilters(),Ut()}),V.on("click","#itemResults tr",function(e){_t(n(this).attr("id"))}),W.on("click",".deleteItem_btn",function(e){e.preventDefault();var t=n(this).attr("data-content");Dt(t)}),W.on("click",".quickAttributes a",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(n(this).attr("data-content"),10),r=n(this).parent().parent().attr("data-content");It(n(this),r,t)}),ct.click(function(e){e.preventDefault(),o.hideSiteGuide(),u.getTagCount()>1?ft.modal("show"):(dt.find(".alertTitle").text("Tag Delete Error"),dt.find(".alertText").text("Cannot delete last tag"),dt.modal("show"))}),lt.click(function(e){e.preventDefault(),ft.modal("hide"),Ht(D)}),vt.find("form").submit(function(e){e.preventDefault(),jt(D,mt.val()),vt.modal("hide")}),gt.click(function(e){jt(D,mt.val()),vt.modal("hide")}),yt.click(function(e){e.preventDefault(),o.hideSiteGuide();var t=u.getTagName(D);mt.val(t),vt.modal("show"),r.delay(function(){mt.focus().select()},1e3)}),pt.find("li").click(function(e){e.preventDefault(),o.hideSiteGuide(),l.startImport(parseInt(n(this).attr("data-importSource"),10))}),J.find("button").click(function(e){e.preventDefault(),Jt(n(this))}),tt.find("li a").click(function(e){e.preventDefault(),Wt(parseInt(n(this).attr("data-content"),10))}),rt.find("li:not(.dropdown-sub) a").click(function(e){e.preventDefault(),F=n(this).attr("data-content"),F=="0"?(o.hideSiteGuide(),y.showFilterPanel()):(zt(!0),ut.text(n(this).text()),Rt(F))}),K.click(function(e){e.preventDefault(),o.hideSiteGuide(),Tt()}),Q.click(function(t){t.preventDefault(),e.viewCollection()}),X.resize(e.resizePanel),n(window).resize(e.resizePanel)};var xt=function(e){var t=0;r.each(e,function(e,n){Lt(e),t++});var s={items:e,length:t};s.displayType=P,s.currentViewTagID=D,W.html(St(s)),t>0&&(W.find(".quickAttributes a").each(function(e,t){n(t).tooltip({delay:{show:750,hide:1},placement:"bottom"})}),r.each(e,function(e,t){Ot(e)}),r.each(e,function(e,t){kt(e)}),M=new i("itemResultsContainer",_),Wt(H),Ut(),B=!1)};e.getItem=function(e){return h.getItem(e)},e.clearItemView=function(){W.html("")},e.resizePanel=function(){var e=n(window).height(),t=X.height(),r=0,i=0;bt.is(":visible")&&(t+=bt.height()),U===E.discussion&&(r=C,i=N);if(t-r<e-q)$.css({height:t+k+i});else{var s=e-q;$.css({height:s+L+r})}},e.loggedInView=function(e){e?q=x:q=T},e.initializeUserItems=function(e,t){return D=A,h.getItems(A,e,t)},e.initializeUserItems_result=function(t){h.itemsAndDirectoryLoaded(t),Nt(A),n.isEmptyObject(t)?f.resetDetail():e.viewRandomItem()},e.updateListDeletions=function(e,t){var r=null;for(var i=0,s=t.length;i<s;i++)D===A?(r=h.getDirectoryItemByItemID(e).tagCount,r===0&&n("#"+e).remove()):D===t[i]&&n("#"+e).remove()},e.updateListAdditions=function(e,t){var n=!1;u.updateViewList(e.tagIDsAdded,D);if(D!==A)for(var r=0,i=e.tagIDsAdded.length;r<i;r++)e.tagIDsAdded[r]==D&&(n=!0);else h.getDirectoryItemByItemID(e.itemID).tagCount>=1&&(n=!0);n&&Nt(D)},e.updateListAttributesChanged=function(e){j=!0},e.showListView=function(e,t,n,r){F=t,Nt(e),ut.text(n),zt(r)},e.viewDiscussion=function(){U=E.discussion,V.removeClass().addClass(U)},e.viewCollection=function(){U=E.collection,V.removeClass().addClass(U)},e.refreshView=function(){Ct(D)};var Tt=function(){c.showGridView(D,F,ut.text(),R)},Nt=function(e){var t="";e!==A?(t=u.getTagName(e),ht.text(t),et.show()):(t=O,et.hide()),Y.text(t),Ct(e)},Ct=function(e,t){D=e,h.getItems(e,function(e){xt(e),t&&t()},function(){xt({})})},kt=function(e){typeof kt.getAmazonItemOffersLimited=="undefined"&&(kt.getAmazonItemOffersLimited=function(e){v.getAmazonItemOffers(e.asin,e,function(t){At(e.id,t)})}.lazy(250,2e3)),kt.getAmazonItemOffersLimited(e),(e.metascore===null||e.metascorePage===null)&&m.getMetascore(e.standardName,e,!1,Mt)},Lt=function(e){var t=h.getDirectoryItemByItemID(e.itemID);t&&(e.gameStatus=t.gameStatus,e.playStatus=t.playStatus,e.userRating=t.userRating)},At=function(e,t){if(typeof t.productURL!="undefined"){var r="#"+e+" .priceDetails";n(r).html(Et(t))}},Ot=function(e){e.metascore===-1?e.displayMetascore="n/a":e.displayMetascore=e.metascore,Mt(e)},Mt=function(e){var t="#"+e.id+" .metascore";m.displayMetascoreData(e.metascorePage,e.metascore,t)};e.viewRandomItem=function(){var e=h.getRandomItemID();_t(e)};var _t=function(t){var n=e.getItem(t);f.viewItemDetail(n)},Dt=function(e){var t=h.deleteSingleTagForItem(e,D,Pt);f.getViewingItemID()===e&&u.removeTagFromAddList(D),n("#"+e).remove()},Pt=function(e){},Ht=function(e){u.deleteTag(e,function(){Bt()})},Bt=function(){Nt(A)},jt=function(e,t){d.updateTag(t,e,function(e){}),u.getTags(function(e){u.getTags_result(e)}),Ft(t,e)},Ft=function(e,t){Y.text(e),mt.val(e)},It=function(t,n,r){var i=e.getItem(n);j=!0;switch(r){case 0:i.playStatus==="1"?(qt(t,"0"),t.parent().removeClass().addClass("playStatus-0"),i.playStatus="0"):(qt(t,"1"),t.parent().removeClass().addClass("playStatus-1"),i.playStatus="1");break;case 1:i.playStatus==="2"?(qt(t,"0"),t.parent().removeClass().addClass("playStatus-0"),i.playStatus="0"):(qt(t,"2"),t.parent().removeClass().addClass("playStatus-2"),i.playStatus="2");break;case 2:i.playStatus==="3"?(qt(t,"0"),t.parent().removeClass().addClass("playStatus-0"),i.playStatus="0"):(qt(t,"3"),t.parent().removeClass().addClass("playStatus-3"),i.playStatus="3");break;case 3:i.userRating==="10"?(t.parent().removeClass("rating-10"),i.userRating="0"):(t.parent().removeClass().addClass("rating-10"),i.userRating="10");break;case 4:i.gameStatus==="1"?(t.parent().removeClass().addClass("gameStatus-0"),i.gameStatus="0"):(t.parent().removeClass().addClass("gameStatus-1"),i.gameStatus="1")}h.updateUserItem(i,function(e,t){f.viewItemDetail(e)})},qt=function(e,t){e.parent().parent().find('span[class*="playStatus"]').each(function(){n(this).removeClass().addClass("playStatus-"+t)})},Rt=function(e){var t=parseInt(e,10);y.resetFilters();if(isNaN(e))y.platformQuickFilter(e);else switch(t){case 1:Wt(S.releaseDate),y.upcomingQuickFilter(M);break;case 2:Wt(S.releaseDate),y.newReleasesQuickFilter(M);break;case 3:Wt(S.metascore),y.neverPlayedQuickFilter(M);break;case 4:Wt(S.metascore),y.gamesPlayingQuickFilter(M);break;case 5:Wt(S.metascore),y.gamesPlayedQuickFilter(M);break;case 6:Wt(S.metascore),y.finishedGamesQuickFilter(M);break;case 7:Wt(S.metascore),y.ownedGamesQuickFilter(M);break;case 8:Wt(S.metascore),y.wantedGamesQuickFilter(M)}Ut(t)},Ut=function(e){e===0&&ut.text("Custom");if(j)j=!1,Nt(D,function(){var e=y.applyListJSFiltering(M)});else var t=y.applyListJSFiltering(M)},zt=function(e){R=e,e?(st.show(),st.next().show()):(st.hide(),st.next().hide())},Wt=function(e){H=e;switch(H){case S.alphabetical:nt.text("Alphabetical"),M.sort("itemName",{asc:!0});break;case S.metascore:nt.text("Review Score"),M.sort("scoreDetails",{sortFunction:Xt});break;case S.releaseDate:nt.text("Release Date"),M.sort("releaseDate",{sortFunction:$t});break;case S.platform:nt.text("Platform"),M.sort("platform",{asc:!0});break;case S.price:nt.text("Price"),M.sort("priceDetails",{sortFunction:Vt})}},Xt=function(e,t){var r=n(e.elm).find(".metascore"),i=n(t.elm).find(".metascore"),s=parseInt(r.attr("data-score"),10),o=parseInt(i.attr("data-score"),10);return s<o?1:-1},Vt=function(e,t){var r=n(e.elm).find(".priceDetails .lowestNew"),i=n(t.elm).find(".priceDetails .lowestNew"),s=0,o=0;return r.length>0&&(s=parseFloat(r.attr("data-price"))),i.length>0&&(o=parseFloat(i.attr("data-price"))),s<o?-1:1},$t=function(e,t){var r=n(e.elm).find(".releaseDate"),i=n(t.elm).find(".releaseDate"),s=Date.parse(r.text()),o=Date.parse(i.text());return o-s},Jt=function(e){e.addClass("active").siblings().removeClass("active");var t=e.attr("data-content");P!==t&&(P=t,W.find("tbody").removeClass().addClass("display-"+P),$.nanoScroller())}}(tmz.module("itemView"),tmz,jQuery,_,List),function(e,t,n,r,i){"use strict";var s=t.module("detailView"),o=t.module("itemData"),u=t.module("itemView"),a=t.module("tagView"),f=t.module("amazon"),l=t.module("utilities"),c=t.module("filterPanel"),h=1,p={itemName:0,metacriticScore:1,releaseDate:2,platform:3,rawPrice:4},d=null,v=0,m=null,g=!0,y=null,b=!1,w=n("#wrapper"),E=n("#gridViewContainer"),S=n("#gridList"),x=S.find(".viewName"),T=n("#gridViewMenu"),N=T.find(".grid_displayOptions"),C=N.find(".displayType"),k=T.find(".sortOptions"),L=k.find(".sortType"),A=T.find(".filterOptions"),O=A.find(".clearFilters_btn"),M=A.find(".filterType"),_=A.find(".filterDropDown_btn"),D=A.find(".listFilters_btn"),P=n("#applyFilters_btn"),H=n("#filters-modal"),B=r.template(n("#grid-results-template").html()),j={},F=!1,I=null;e.init=function(){q(),_.tooltip({delay:{show:500,hide:50},placement:"bottom"}),N.find("div").each(function(e,t){n(t).tooltip({delay:{show:500,hide:50},placement:"bottom"})}),it(!1)};var q=function(e){T.on("mouseenter",".dropdown-toggle",function(e){var t=this;T.find(".dropdown").each(function(){n(this).hasClass("open")&&n(this).find(".dropdown-toggle").get(0)!==n(t).get(0)&&n(t).trigger("click")})}),n("#exitGridView_btn").click(function(e){e.preventDefault(),U()}),D.click(function(e){e.preventDefault(),H.modal("show")}),O.click(function(e){e.preventDefault(),it(!1),M.text("None"),c.resetFilters(),Q()}),P.click(function(e){e.preventDefault(),Q(),it(!0)}),S.find("ul").on("click","a",function(e){e.preventDefault(),z(n(this).attr("data-content"))}),E.on("click",".gridItem img",function(e){e.preventDefault(),J(n(this).parent().parent().attr("data-content"))}),E.on("mouseover",".gridItem",function(e){e.preventDefault();var t=n(this),r=t.attr("data-content"),i=j[r];i||(i=t.width(),j[r]=i);var s=Math.round((i*1.2-i)/2);t.css({"z-index":"999",width:i*1.2+"px","-webkit-transition-timing-function":"cubic-bezier(0.01,0.53,0.00,1.00)","-webkit-transition-property":"top,left,width","-webkit-transition-duration":"1s"})}),E.on("mouseout",".gridItem",function(e){e.preventDefault();var t=n(this);t.css({"z-index":"",width:"","-webkit-transition-timing-function":"cubic-bezier(0.01,0.53,0.00,1.00)","-webkit-transition-property":"top,left,width","-webkit-transition-duration":"1s"})}),N.find("li a").click(function(e){e.preventDefault(),C.text(n(this).text()),st(n(this).attr("data-content"))}),k.find("li a").click(function(e){e.preventDefault(),G(n(this).attr("data-content"))}),A.find("li a").click(function(e){e.preventDefault(),y=parseInt(n(this).attr("data-content"),10),y===0?c.showFilterPanel():(it(!0),M.text(n(this).text()),K(parseInt(n(this).attr("data-content"),10)))})};e.showGridView=function(e,t,n,r){i.success("Loading Grid View images"),w.removeClass("standardView"),w.addClass("gridView"),y=t,R(e),W(e),M.text(n),it(r)};var R=function(e){var t=S.find('a[data-content="'+e+'"]');S.find(".viewName").text(t.text())},U=function(){w.removeClass("gridView"),w.addClass("standardView"),u.showListView(d,y,M.text(),b)},z=function(e){d=e,R(e),W(e)},W=function(e){d=e,E.hide(),F&&E.isotope("destroy"),o.getItems(e,X)},X=function(e){V(e)},V=function(e){var t={items:e};E.html(B(t)),$(),E.imagesLoaded(function(){E.show(),$(),Q()})},$=function(){F=!0,E.isotope({itemSelector:".gridItem",getSortData:{itemName:Y,releaseDate:Z,platform:et,userRating:tt,metacriticScore:nt,rawPrice:rt},sortBy:"itemName",sortAscending:!0,transformsEnabled:!1})},J=function(e){var t=o.getItem(e);s.viewItemDetail(t)},K=function(e){ot();var t=parseInt(e,10);c.resetFilters();switch(t){case 1:c.upcomingQuickFilter(),L.text("Release Date"),m="releaseDate",g=!0;break;case 2:c.newReleasesQuickFilter(),L.text("Release Date"),m="releaseDate",g=!1;break;case 3:c.neverPlayedQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1;break;case 4:c.gamesPlayingQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1;break;case 5:c.gamesPlayedQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1;break;case 6:c.finishedGamesQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1;break;case 7:c.ownedGamesQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1;break;case 8:c.wantedGamesQuickFilter(),L.text("Review Score"),m="metacriticScore",g=!1}Q()},Q=function(){y===0&&M.text("Custom"),it(c.applyIsotopeFiltering(E,m,g))},G=function(e){ot(),v=parseInt(e,10);switch(v){case p.itemName:L.text("Alphabetical"),m="itemName",E.isotope({sortBy:m,sortAscending:!0});break;case p.metacriticScore:L.text("Review Score"),m="metacriticScore",E.isotope({sortBy:m,sortAscending:!1});break;case p.releaseDate:L.text("Release Date"),m="releaseDate",E.isotope({sortBy:m,sortAscending:!1});break;case p.platform:L.text("Platform"),m="platform",E.isotope({sortBy:m,sortAscending:!0});break;case p.rawPrice:L.text("Price"),m="rawPrice",E.isotope({sortBy:m,sortAscending:!0})}},Y=function(e){return e.find(".itemName").text()},Z=function(e){return e.find(".releaseDate").text()},et=function(e){return e.find(".platform").text()},tt=function(e){return parseInt(e.find(".userRating").text(),10)},nt=function(e){return parseInt(e.find(".metacriticScore").text(),10)},rt=function(e){return parseInt(e.find(".rawPrice").text(),10)},it=function(e){b=e,e?(O.show(),O.next().show()):(O.hide(),O.next().hide())},st=function(e){ot(),j={},I!==e&&(E.removeClass("display-"+I).addClass("display-"+e),I=e,E.isotope("reLayout",function(){}))},ot=function(e){n(".gridItem").each(function(e,t){n(t).css({"z-index":"","-webkit-transition-property":""})})}}(tmz.module("gridView"),tmz,jQuery,_,alertify),function(e,t,n,r){"use strict";var i=t.module("user"),s=t.module("tagData"),o=t.module("itemData"),u=t.module("itemCache"),a=n("#addListContainer"),f=n("#addList"),l=n("#viewList"),c=n("#gridList"),h={},p={},d={},v={},m={},g={},y=[],b=r.template(n("#view-list-template").html()),w=function(){E()},E=function(){f.change(function(e){var t=f.val().split(","),n=t[t.length-1];n!==""&&O(n)})},S=function(e,t){return q(),s.getTags(e,t)},x=function(e){W(),X(e),T(),I()},T=function(){var e=[],t=[];r.each(p,function(t,n){e.push(t)}),r.each(d,function(e,n){t.push(e)}),e.sort(V);var n={orderedList:e,emptyList:t};l.find("ul").html(b(n)),c.find("ul").html(b(n))},N=function(e){return v[e]},C=function(){var e=0;return r.each(h,function(t){e++}),e},k=function(){var e=[],t=U();return r.each(t,function(t){r.has(g,t)||(g[t]="placeholder",e.push(t))}),e},L=function(){var e=[],t=[],n=U();return r.each(g,function(i,s){r.indexOf(n,s)===-1&&(delete g[s],t.push(s),e.push(i))}),{idsToDelete:e,tagsToDelete:t}},A=function(e,t){for(var n=0,r=t.length;n<r;n++)g[e[n]]=t[n]},O=function(e,t){if(!r.has(h,e))s.addTag(e,function(e){R(e),t&&t(e)});else if(t){var n={tagID:h[e].id,tagName:h[e].name};t(n)}},M=function(e,t){var n=u.getCachedItemsByTag(e);r.each(n,function(t,n){o.deleteClientItem(e,t.itemID),o.deleteTagFromDirectory(t.itemID,e)}),_(e),u.deleteCachedTag(e),s.deleteTag(e),S(function(e){x(e)}),t()},_=function(e){delete g[e],z(g)},D=function(e){g={};var t=null;r.each(e,function(e,t){g[t]=e}),z(e)},P=function(){y=f.val().split(",")},H=function(){g={},f.val(y).trigger({type:"change",reset:!1})},B=function(e,t){var n=!1;for(var r=0,i=e.length;r<i;r++)typeof m[e[r]]=="undefined"&&(m[e[r]]=!0,delete d[v[e[r]]],p[v[e[r]]]={id:e[r],name:v[e[r]]},n=!0);return n&&T(),n},j=function(){g={},y=[],f.val([""]).trigger({type:"change",reset:!0})},F=function(){var e=!1,t=U();return r.each(t,function(t){r.has(g,t)||(e=!0)}),r.each(g,function(n,i){r.indexOf(t,i)===-1&&(e=!0)}),e},I=function(){var e=[],t=[];r.each(h,function(n,r){e.push(n),t.push(n.name)}),e.sort(V),f.select2({tags:t,placeholder:"Type a tag name",allowClear:!0})},q=function(){h={},p={},d={},v={},m={},g={},y=[]},R=function(e){var t={name:e.tagName.toLowerCase(),id:e.tagID};h[t.name]=t,d[t.name]=t,v[t.id]=t.name,T(),I(),a.find(".select2-search-field input").focus()},U=function(){var e=f.val(),t=[];return e!==""&&r.each(e.split(","),function(e){r.has(h,e)?t.push(h[e].id):t.push(e)}),t},z=function(e){var t=[];r.each(e,function(e,n){var r=N(n);t.push(r)}),f.val(t).trigger({type:"change",reset:!1})},W=function(){var e=o.getItemDirectory();m={},r.each(e,function(e,t){r.each(e.tags,function(e,t){typeof m[t]=="undefined"&&(m[t]=!0)})})},X=function(e){var t={};for(var n=0,r=e.length;n<r;n++)t={},t.name=e[n].tagName.toLowerCase(),t.id=e[n].tagID,typeof m[t.id]!="undefined"?p[t.name]=t:d[t.name]=t,h[t.name]=t,v[t.id]=t.name},V=function(e,t){var n=e.name,r=t.name;return n.toLowerCase().localeCompare(r.toLowerCase())},$={init:w,getTags:S,getTags_result:x,renderViewLists:T,getTagName:N,getTagCount:C,getTagsToAdd:k,getTagsToDelete:L,updateInitialItemTags:A,addTag:O,deleteTag:M,removeTagFromAddList:_,selectTagsFromDirectory:D,updateUserTags:P,selectUserTags:H,updateViewList:B,resetAddList:j,isAddListChanged:F};n.extend(e,$)}(tmz.module("tagView"),tmz,jQuery,_),function(e,t,n,r,i){"use strict";var s=t.module("utilities"),o=n("#filters-modal"),u=n("#releaseDate_filter"),a=n("#gameStatus_filter"),f=n("#playStatus_filter"),l=n("#metascore_filter"),c=n("#platformFilterList");e.init=function(){e.createEventHandlers(),c.select2({placeholder:"Select platform",allowClear:!0})},e.createEventHandlers=function(){o.on("click",".btn-group button",function(e){e.preventDefault()})},e.showFilterPanel=function(){o.modal("show")},e.getFilters=function(){var e={};e.releaseDateFilters=[],e.metascoreFilters=[],e.platformFilters=[],e.gameStatusFilters=[],e.playStatusFilters=[],u.find("button").each(function(){n(this).hasClass("active")?e.releaseDateFilters.push(!0):e.releaseDateFilters.push(!1)}),l.find("button").each(function(){n(this).hasClass("active")?e.metascoreFilters.push(!0):e.metascoreFilters.push(!1)}),a.find("button").each(function(){n(this).hasClass("active")?e.gameStatusFilters.push(!0):e.gameStatusFilters.push(!1)}),f.find("button").each(function(){n(this).hasClass("active")?e.playStatusFilters.push(!0):e.playStatusFilters.push(!1)});var t=c.val(),i=[];return t&&t!==""&&(i=t.split(",")),r.each(i,function(t,n){e.platformFilters[n]=s.getStandardPlatform(t)}),e},e.applyListJSFiltering=function(t){var n=e.getFilters(),r=!1;return t.filter(function(t){var i=e.releaseDateFilter(t.values().releaseDate,n.releaseDateFilters),s=e.metascoreFilter(t.values().metascore,n.metascoreFilters),o=e.platformFilter(t.values().platform,n.platformFilters),u=e.gameStatusFilter(t.values().gameStatus,n.gameStatusFilters),a=e.playStatusFilter(t.values().playStatus,n.playStatusFilters);return i&&s&&o&&a&&u?!0:(r=!0,!1)}),r},e.applyIsotopeFiltering=function(t,r,i){var s=e.getFilters(),o=!1,u=n(".gridItem").filter(function(t){var r=n(this),i=r.find(".releaseDate").text(),u=e.releaseDateFilter(i,s.releaseDateFilters),a=r.find(".metacriticScore").text(),f=e.metascoreFilter(a,s.metascoreFilters),l=r.find(".platform .data").text(),c=e.platformFilter(l,s.platformFilters),h=r.find(".gameStatus").text(),p=e.gameStatusFilter(h,s.gameStatusFilters),d=r.find(".playStatus").text(),v=e.playStatusFilter(d,s.playStatusFilters);return u&&p&&v&&f&&c?!0:(o=!0,!1)});return t.isotope({filter:u,sortBy:r,sortAscending:i}),o},e.resetFilters=function(){u.find("button").each(function(){n(this).removeClass("active")}),l.find("button").each(function(){n(this).removeClass("active")}),a.find("button").each(function(){n(this).removeClass("active")}),f.find("button").each(function(){n(this).removeClass("active")}),c.val([""]).trigger("change")},e.upcomingQuickFilter=function(e){u.find('button[data-content="0"]').addClass("active")},e.newReleasesQuickFilter=function(e){u.find('button[data-content="1"]').addClass("active")},e.neverPlayedQuickFilter=function(e){f.find('button[data-content="0"]').addClass("active")},e.gamesPlayingQuickFilter=function(e){f.find('button[data-content="1"]').addClass("active")},e.gamesPlayedQuickFilter=function(e){f.find('button[data-content="2"]').addClass("active")},e.finishedGamesQuickFilter=function(e){f.find('button[data-content="3"]').addClass("active")},e.ownedGamesQuickFilter=function(e){a.find('button[data-content="1"]').addClass("active")},e.wantedGamesQuickFilter=function(e){a.find('button[data-content="3"]').addClass("active")},e.platformQuickFilter=function(e){c.val(e).trigger("change")},e.releaseDateFilter=function(e,t){var n=t[0],r=t[1],s=null;e==="1900-01-01"?s=i().add("days",1):s=i(e,"YYYY-MM-DD");var o=i(),u=s.diff(o,"seconds");return n&&r?!0:!n&&!r?!0:n&&u>0?!0:r&&u<0?!0:!1},e.gameStatusFilter=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3];return n&&r&&i&&s?!0:!n&&!r&&!i&&!s?!0:n&&e==="0"?!0:r&&e==="1"?!0:i&&e==="2"?!0:s&&e==="3"?!0:!1},e.playStatusFilter=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3];return n&&r&&i&&s?!0:!n&&!r&&!i&&!s?!0:n&&e==="0"?!0:r&&e==="1"?!0:i&&e==="2"?!0:s&&e==="3"?!0:!1},e.metascoreFilter=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=parseInt(e,10);return n&&r&&i&&s&&o&&u&&a?!0:!n&&!r&&!i&&!s&&!o&&!u&&!a?!0:n&&f>=90?!0:r&&f>=80&&f<90?!0:i&&f>=70&&f<80?!0:s&&f>=60&&f<70?!0:o&&f>=50&&f<60?!0:u&&f>=25&&f<50?!0:a&&f>=0&&f<25?!0:!1},e.platformFilter=function(e,t){if(t.length===0)return!0;for(var n=0,r=t.length;n<r;n++)if(t[n].name===e)return!0;return!1}}(tmz.module("filterPanel"),tmz,$,_,moment),function(e,t,n,r,i,s){"use strict";var o="http://media.giantbomb.com/video/",u="videoPlayer",a=91,f=5,l=!1,c=0,h=null,p=0,d=0,v=0,m=[],g=null,y=r("#video-modal"),b=r("#videoListContainer"),w=r("#videoList"),E=r("#videoPlayer"),S=r("#videoModalTitle"),x=r("#videoListNavigation"),T=x.find(".navigateLeft"),N=x.find(".navigateRight"),C=x.find(".pageNumber"),k=i.template(r("#video-results-template").html());e.init=function(){g=t(u),e.createEventHandlers(),y.modal({backdrop:!0,show:!1})},e.createEventHandlers=function(){w.on("click","li",function(e){e.preventDefault();var t=r(this).attr("data-id");O(Number(t)),M()}),T.click(function(e){H()}),N.click(function(e){B()}),y.on("hidden",function(){_()}),g.addEvent("ended",A)},e.showVideoPanel=function(){l&&(l=!1,O(0)),r("html, body").scrollTop(0),y.modal("show"),M()},e.renderVideoModal=function(e,t){l=!0,m=r.extend(!0,[],e);if(m.length!==0){p=m.length,h=null,d=0,L(m);var n={videoResults:m};w.html(k(n)),S.text(t),c=0,F(0),w.find("a").popover({trigger:"hover",placement:"top",animation:!0}),P()}m.length<=f&&D()};var L=function(e){for(var t=0,n=e.length;t<n;t++){e[t].publishDate=s(e[t].publish_date,"YYYY-MM-DD").calendar(),delete e[t].publish_date;var r=Math.floor(e[t].length_seconds/60),i=(e[t].length_seconds%60).toString();i.length===1&&(i="0"+i),delete e[t].length_seconds,e[t].runningTime=r+":"+i}},A=function(){d===p-1?d=0:d++,O(d);if(d%f===0){var e=Math.floor(d/f);F(e)}M()},O=function(e){d=e;var t=m[e].url,n=w.find('li[data-id="'+e+'"]'),r=w.find('li[data-id="'+v+'"]');r.removeClass("playing"),n.addClass("playing");var i=t.split("."),s=o+i[0]+"_3500."+i[1];g.src(s),v=e},M=function(){g.play()},_=function(){g.pause()},D=function(){x.hide()},P=function(){x.show()},H=function(){var e=j();c>0?F(--c):F(e)},B=function(){var e=j();c<e?F(++c):F(0)},j=function(){return h||(h=Math.ceil(p/f)-1),h},F=function(e){var t=-(e*a);c=e,w.stop().animate({top:t},250,function(){}),C.text(Number(e+1)+" / "+Number(j()+1))}}(tmz.module("videoPanel"),_V_,tmz,jQuery,_,moment),function(e,t,n,r,i){"use strict";var s=t.module("utilities"),o=["accessory","case","codes","combo","console","controller","covers","face plate","faceplate","head set","headset","import","japan","kit","map","membership","new","pack","poster","pre-paid","set","shell","skin","software","stylus","wireless"],u=t.api+"amazon/search/",a=t.api+"amazon/detail/",f={},l={},c={},h={},p=null,d=0;e.searchAmazon=function(e,t,r,i,s){s=typeof s!="undefined"?s:!1;var o=encodeURIComponent(e),a={keywords:e,browse_node:t,search_index:"VideoGames",response_group:"ItemAttributes,Images",page:1};p&&s&&p.abort();var f=++d;return p=n.ajax({url:u,type:"GET",data:a,dataType:"xml",cache:!0,success:function(e){if(f===d||!s)p=null,r(e)},error:function(){i()}}),p},e.parseAmazonResultItem=function(e){var t=!1,n="("+o.join("|")+")",r=new RegExp(n,"i"),u={name:e.find("Title").text(),platform:e.find("Platform").text()};return r.test(u.name)||u.platform===""?u.isFiltered=!0:(u.id=e.find("ASIN").text(),u.asin=e.find("ASIN").text(),u.gbombID=0,u.smallImage=e.find("ThumbnailImage > URL:first").text()||"",u.thumbnailImage=e.find("MediumImage > URL:first").text()||"",u.largeImage=e.find("LargeImage > URL:first").text()||"",u.description=e.find("EditorialReview > Content:first").text()||"",u.releaseDate=e.find("ReleaseDate").text()||"1900-01-01",u.platform=s.matchPlatformToIndex(u.platform).name,u.releaseDate!=="1900-01-01"?u.calendarDate=i(u.releaseDate,"YYYY-MM-DD").calendar():u.calendarDate="Unknown"),u},e.getAmazonItemDetail=function(e,t,i){var s=g(e);if(s)t(s);else{r.has(h,e)||(h[e]=[]),h[e].push(t);if(h[e].length===1){var o={asin:e,response_group:"Medium"};n.ajax({url:a,type:"GET",data:o,dataType:"xml",cache:!0,success:function(t){r.each(h[e],function(n){l[e]=t,n(t)}),h[e]=[]},error:i})}}},e.getAmazonItemOffers=function(e,t,i,s){var o=m(e);if(o)t.offers=o,i(o);else{r.has(c,e)||(c[e]=[]),c[e].push(i);if(c[e].length===1){var u={asin:e,response_group:"OfferFull"};n.ajax({url:a,type:"GET",data:u,dataType:"xml",cache:!0,success:function(n){r.each(c[e],function(r){var i=y(n,t);f[e]=i,r(i)}),c[e]=[]},error:s})}}};var v=function(e){var t=null,n=null;for(var r=0,i=e.offers.length;r<i;r++)e.offers[r].availability==="now"&&(t=e.offers[r].price,n=e.offers[r].rawPrice);t=t||e.lowestNewPrice,t==="Too low to display"&&(t="n/a",n=0),e.lowestNewPrice==="Too low to display"&&(e.lowestNewPrice="n/a"),e.buyNowPrice=t,e.buyNowRawPrice=n},m=function(e){var t=null;return typeof f[e]!="undefined"&&(t=f[e]),t},g=function(e){var t=null;return typeof l[e]!="undefined"&&(t=l[e]),t},y=function(e,t){var r={};return n("Item",e).each(function(){r=b(n(this))}),t.offers=r,r},b=function(e){var t={},r={},i=/\$/;t.lowestNewPrice=e.find("LowestNewPrice FormattedPrice").text().replace(i,""),t.lowestUsedPrice=e.find("LowestUsedPrice FormattedPrice").text().replace(i,""),t.totalNew=e.find("TotalNew").text(),t.totalUsed=e.find("TotalUsed").text(),t.totalOffers=e.find("TotalOffers").text(),t.offersURL=e.find("MoreOffersUrl").text(),t.offersURLNew=e.find("MoreOffersUrl").text()+"&condition=new",t.offersURLUsed=e.find("MoreOffersUrl").text()+"&condition=used";var s=/offer-listing/gi;return t.productURL=t.offersURL.replace(s,"product"),t.offers=[],n("Offer",e).each(function(){r={},r.price=n(this).find("Price FormattedPrice").text().replace(i,""),r.rawPrice=n(this).find("Price Amount").text(),r.availability=n(this).find("AvailabilityType").text(),r.freeShipping=n(this).find("IsEligibleForSuperSaverShipping").text(),t.offers.push(r)}),v(t),t}}(tmz.module("amazon"),tmz,jQuery,_,moment),function(e,t,n,r,i){"use strict";var s=t.module("amazon"),o=t.api+"giantbomb/search/",u=t.api+"giantbomb/detail/",a={},f={},l={},c={};e.searchGiantBomb=function(e,t,r){var i=encodeURIComponent(e),s=["id","name","original_release_date","image"],u={field_list:s.join(","),keywords:e,page:0},a=n.ajax({url:o,type:"GET",data:u,dataType:"json",cache:!0,success:t,error:r});return a},e.parseGiantBombResultItem=function(e){var t={id:e.id,asin:0,gbombID:e.id,name:e.name,platform:"n/a"};return e.original_release_date&&e.original_release_date!==""?t.releaseDate=e.original_release_date.split(" ")[0]:t.releaseDate="1900-01-01",t.releaseDate!=="1900-01-01"?t.calendarDate=i(t.releaseDate,"YYYY-MM-DD").calendar():t.calendarDate="Unknown",e.image&&e.image.small_url&&e.image.small_url!==""?t.smallImage=e.image.small_url:t.smallImage="no image.png",e.image&&e.image.thumb_url&&e.image.thumb_url!==""?t.thumbnailImage=e.image.thumb_url:t.thumbnailImage="no image.png",e.image&&e.image.super_url&&e.image.super_url!==""?t.largeImage=e.image.super_url:t.largeImage="no image.png",e.description&&e.description!==""?t.description=e.description:t.description="No Description",t},e.getGiantBombItemPlatform=function(e,t,n){var r=["platforms"],i=h(e,r,function(n){t(n,e)},n);return i},e.getGiantBombItemData=function(e,t,n){var i=p(e);if(i)t(i);else{r.has(l,e)||(l[e]=[]),l[e].push(t);if(l[e].length===1){var s=["description","site_detail_url","videos"];h(e,s,function(t){r.each(l[e],function(n){a[e]=t.results,n(t.results)}),l[e]=[]},n)}}},e.getGiantBombItemDetail=function(e,t,n){var i=d(e);if(i)t(i);else{r.has(c,e)||(c[e]=[]),c[e].push(t);if(c[e].length===1){var s=["id","name","original_release_date","image"];h(e,s,function(t){r.each(c[e],function(n){f[e]=t.results,n(t.results)}),c[e]=[]},n)}}};var h=function(e,t,r,i){var s={field_list:t.join(","),id:e},o=n.ajax({url:u,type:"GET",data:s,dataType:"json",cache:!0,success:r,error:i});return o},p=function(e){var t=null;return typeof a[e]!="undefined"&&(t=a[e]),t},d=function(e){var t=null;return typeof f[e]!="undefined"&&(t=f[e]),t}}(tmz.module("giantbomb"),tmz,jQuery,_,moment),function(e,t,n,r){"use strict";var i=t.module("amazon"),s=t.module("itemLinker"),o=t.module("itemData"),u=t.api+"metacritic/search/",a=t.api+"metacritic/cache/",f="metacritic.com",l={},c={};e.getMetascore=function(e,t,i,s){var a=null,f=p(t.asin,t.gbombID,t.platform);if(f)a=f,t.metascore=f.metascore,t.metascorePage=f.metascorePage,s(t);else{var l=e+"_"+t.platform;r.has(c,l)||(c[l]=[]),c[l].push(s);if(c[l].length===1){var g=h(e),y={keywords:encodeURI(g),platform:encodeURI(t.platform)};a=n.ajax({url:u,type:"GET",data:y,cache:!0,success:function(e){var n=t.metascore,s=v(g,e,t);m(s,t),!i&&t.metascore!=n&&o.updateMetacritic(t),r.each(c[l],function(e){d(t.asin,t.gbombID,t.platform,t),e(t)}),c[l]=[]}})}}return a},e.displayMetascoreData=function(e,t,r){var i=n(r),s=t,o="favorable";t<0?(s="n/a",o="unavailable"):t<50?o="unfavorable":t<75&&(o="neutral"),i.html(s).removeClass("unavailable").removeClass("unfavorable").removeClass("neutral").removeClass("favorable").addClass(o).attr("href","http://www."+f+e).attr("data-score",t).attr("data-original-title",f+" "+e).show(),i.tooltip({placement:"left"})};var h=function(e){n=/\s*[:&]\s*/g;var t=e.replace(n," "),n=/\s/g;return t=t.replace(n,"+"),t},p=function(e,t,n){var r=null;return typeof l[e+"_"+n]!="undefined"?r=l[e+"_"+n]:typeof l[t+"_"+n]!="undefined"&&(r=l[t+"_"+n]),r},d=function(e,t,n,r){e!="0"&&(l[e+"_"+n]={metascorePage:r.metascorePage,metascore:r.metascore}),t!="0"&&(l[t+"_"+n]={metascorePage:r.metascorePage,metascore:r.metascore})},v=function(e,t,n){var r=null;return typeof t.metascore=="undefined"?(r=y(t,n),r&&g(e,n.platform,r.metascore,r.metascorePage)):r=t,r},m=function(e,t){e&&e.metascore!==""?(t.metascore=e.metascore,t.displayMetascore=e.metascore,t.metascorePage=e.metascorePage):e?(t.metascore=-1,t.displayMetascore="n/a",t.metascorePage=e.metascorePage):(t.metascore=-1,t.displayMetascore="n/a",t.metascorePage="")},g=function(e,t,r,i){var s={keywords:encodeURI(e),platform:encodeURI(t),metascore:encodeURI(r),metascorePage:encodeURI(i)};n.ajax({url:a,type:"GET",data:s,cache:!0,success:function(e){}})},y=function(e,t){var r=n("#main",e).find(".result"),i={},o=null,u=-99999,a=0;return n(r).each(function(){var e=new Date(n(this).find(".release_date .data").text()),r=e.getMonth()+1;r=r<10?"0"+r:r;var f=e.getDate();f=f<10?"0"+f:f,i={name:n(this).find(".product_title a").text(),releaseDate:e.getFullYear()+"-"+r+"-"+f,platform:n(this).find(".platform").text(),metascore:n(this).find(".metascore").text(),metascorePage:n(this).find(".product_title a").attr("href")},a=s.getSimilarityScore(t,i),a>u&&(o=i,u=a)}),o}}(tmz.module("metacritic"),tmz,jQuery,_),function(e){var t=tmz.module("user"),n=tmz.module("utilities"),r=tmz.module("itemLinker"),i={};e.getWikipediaPage=function(e,t,n){var u=i[t.id];u&&typeof u.wikipediaPage!="undefined"?n(u.wikipediaPage):s(e,function(e){pageArray=e[1],r.findWikipediaMatch(pageArray,t,function(e){o(e.name,function(e){_.each(e.query.pages,function(e,r){u?u.wikipediaPage=e.fullurl:i[t.id]={wikipediaPage:e.fullurl},n(e.fullurl)})})})})};var s=function(e,t,n){var r="http://en.wikipedia.org/w/api.php?action=opensearch&format=json&callback=?",i={search:e,prop:"revisions",rvprop:"content"};$.ajax({url:r,type:"GET",data:i,dataType:"jsonp",cache:!1,crossDomain:!0,success:t,error:n})},o=function(e,t,n){var r="http://en.wikipedia.org/w/api.php?action=query&format=json&callback=?",i={titles:e,prop:"info",inprop:"url"};$.ajax({url:r,type:"GET",data:i,dataType:"jsonp",cache:!1,crossDomain:!0,success:t,error:n})}}(tmz.module("wikipedia")),function(e,t,n,r){"use strict";var i=t.module("amazon"),s=t.module("itemLinker"),o=t.module("itemData"),u=t.api+"gametrailers/search/",a=t.api+"gametrailers/cache/",f="gametrailers.com",l={},c={};e.getGametrailersPage=function(e,t,i){var s=null,o=p(e);if(o)t.gametrailersPage=o.gametrailersPage,i(t.gametrailersPage);else{var a=e+"_";r.has(c,a)||(c[a]=[]),c[a].push(i);if(c[a].length===1){var f=h(e),l={keywords:encodeURI(f)};s=n.ajax({url:u,type:"GET",data:l,cache:!0,success:function(n){var i=v(f,n,t);r.each(c[a],function(n){t.gametrailersPage=i,d(e,i),n(i)}),c[a]=[]}})}}return s};var h=function(e){n=/\s*[:&]\s*/g;var t=e.replace(n," "),n=/\s/g;return t=t.replace(n,"+"),t},p=function(e){var t=null;return typeof l[e]!="undefined"&&(t=l[e]),t},d=function(e,t){l[e]={gametrailersPage:t}},v=function(e,t,n){var r=null;return typeof t.gametrailersPage=="undefined"?(r=g(t,n),r&&m(e,r)):r=t.gametrailersPage,r},m=function(e,t){var r={keywords:encodeURI(e),gametrailersPage:encodeURI(t)};n.ajax({url:a,type:"GET",data:r,cache:!0,success:function(e){}})},g=function(e,t){var r=n("#games",e).find(".video_game_information_child"),i={},o=null,u=-99999,a=0;return n(r).each(function(){i={name:n(this).find(".content h3 a").text(),releaseDate:n(this).find(".content dl dd:eq(1) a").text(),gametrailersPage:n(this).find(".content h3 a").attr("href")},a=s.getSimilarityScore(t,i),a>u&&(o=i,u=a)}),o.gametrailersPage+"/videos-trailers"}}(tmz.module("gameTrailers"),tmz,jQuery,_),function(e,t,n,r){"use strict";var i=t.module("itemLinker"),s=t.api+"steam/search/",o=t.api+"steam/cache/",u="http://store.steampowered.com/",a={},f={};e.getSteamGame=function(e,t,i){var o=null,u=c(e);if(u)t.steamPage=u.steamPage,t.steamPrice=u.steamPrice,i(u);else{var a=e+"_";r.has(f,a)||(f[a]=[]),f[a].push(i);if(f[a].length===1){var d=l(e),v={keywords:encodeURI(d)};o=n.ajax({url:s,type:"GET",data:v,cache:!0,success:function(n){var i=p(d,n,t);r.each(f[a],function(n){t.steamItem=i.steamPage,t.steamPrice=i.steamPrice,h(e,i.steampage,i.steamPrice),n(i)}),f[a]=[]}})}}return o};var l=function(e){n=/\s*[:&]\s*/g;var t=e.replace(n," "),n=/\s/g;return t=t.replace(n,"+"),t},c=function(e){var t=null;return typeof a[e]!="undefined"&&(t=a[e]),t},h=function(e,t,n){a[e]={steamPage:t,steamPrice:n}},p=function(e,t,n){var r=v(t,n);return r&&d(e,r.steamPage,r.steamPrice),r},d=function(e,t,r){var i={keywords:encodeURI(e),url:encodeURI(t),price:encodeURI(r)};n.ajax({url:o,type:"GET",data:i,cache:!0,success:function(e){}})},v=function(e,t){var n=null,s=-99999,o=0;return r.each(e,function(e){console.info(e),o=i.getSimilarityScore(t,e),console.info(o),o>s&&(n={steamPage:e.page,steamPrice:e.price},s=o)}),n}}(tmz.module("steam"),tmz,jQuery,_),function(e,t,n,r){"use strict";var i=t.api+"list/popular/",s={};e.getPopularGamesListByPlatform=function(e,t){var r=o(e);if(r)t(r);else{var u={platform:e};n.ajax({url:i,type:"GET",data:u,cache:!0,success:function(n){s[e]=n,t(n)}})}};var o=function(e){var t=null;return typeof s[e]!="undefined"&&(t=s[e]),t},u=function(){}}(tmz.module("gameStats"),tmz,jQuery,_),function(e,t,n,r){var i=t.api+"list/upcoming/",s={};e.getUpcomingGames=function(e,t,r){var u=o(e,t);if(u)r(u);else{var a={platform:e,page:t};n.ajax({url:i,type:"GET",data:a,cache:!0,success:function(n){s[e+"_"+t]=n,r(n)}})}};var o=function(e,t){var n=null;return typeof s[e+"_"+t]!="undefined"&&(n=s[e+"_"+t]),n},u=function(){}}(tmz.module("ign"),tmz,jQuery,_),function(e,t,n,r){"use strict";var i=t.module("utilities"),s=t.api+"list/released/",o={},u={},a={};e.getReleasedGames=function(e,t,i,p,d){var v=h(t,i,p),m=null;if(v){var g=c(v,e);d(g,u)}else{var y=t+"_"+i+"_"+p;if(!r.has(a,y)){var b={platform:e};a[y]=b;var w={year:t,month:i,day:p};m=n.ajax({url:s,type:"GET",data:w,cache:!0,success:function(e){f(e),l(e);var n=c(e,a[y].platform);o[t+"_"+i+"_"+p]=e,d(n,u),delete a[y]}})}else a[y].platform=e}return m};var f=function(e){r.each(e,function(e){var t=e.platforms.split(",");e.linkedPlatforms={all:undefined},r.each(t,function(t){var n=r.str.trim(t),s=i.getStandardPlatform(n);e.linkedPlatforms[s.id]=s.name})})},l=function(e){r.each(e,function(e){r.each(e.linkedPlatforms,function(e,t){r.has(u,t)?u[t]=u[t]+1:u[t]=1})})},c=function(e,t){var n=[];return r.each(e,function(e){e.name=e.name.replace(/\sbox\s*.*/gi,""),r.has(e.linkedPlatforms,t)&&n.push(e)}),n},h=function(e,t,n){var r=null;return typeof o[e+"_"+t+"_"+n]!="undefined"&&(r=o[e+"_"+t+"_"+n]),r}}(tmz.module("releasedList"),tmz,jQuery,_),function(e,t,n,r){"use strict";var i=t.module("amazon"),s=t.module("giantbomb"),o=t.module("utilities");e.standardizeTitle=function(e){var t=e,n=null,r=null,i=null,s=null,o="",u=0,a=0,f=null;return t=t.replace(/\s*[\[\(].*[\)\]]/gi,""),t=t.replace(/\s*trophies/gi,""),t=t.replace(/\S+ edition$/gi,""),t=t.replace(/\swith\s.*/gi,""),t=t.replace(/^\s*the\s/gi,""),i&&i[0].length>3&&(t=t.replace(n,"")),t.toLowerCase()},e.getSimilarityScore=function(t,n){var r=0,i=e.standardizeTitle(n.name);if(t.standardName===n.name.toLowerCase())r+=50;else{var s=new RegExp(t.standardName,"gi"),u=new RegExp(i,"gi"),a=s.exec(i),f=u.exec(t.standardName);if(a&&a[0].length>0||f&&f[0].length>0)r+=5}if(typeof n.releaseDate!="undefined")if(t.releaseDate===n.releaseDate)r+=10;else{var l=Math.floor((Date.parse(t.releaseDate)-Date.parse(n.releaseDate))/864e5);!isNaN(l)&&n.releaseDate!=="1900-01-01"&&(r-=Math.abs(l/365))}if(typeof n.platform!="undefined"){var c=o.matchPlatformToIndex(n.platform).name;t.platform===c&&(r+=20)}return r},e.convertRomanNumerals=function(e){var t=new RegExp("\\s[XVI]+","gi"),n=t.exec(e);if(n&&n[0].length>0){var r=n[0],i=new RegExp("III","gi"),s=i.exec(r),o="";s&&s[0].length>0&&(o=3,r=r.replace(i,""));var u=r.split(""),a=null;for(var f=u.length-1;f>=1;f--){switch(u[f]){case"I":a=1;break;case"V":a=5;break;case"X":a=10}a<o?o-=a:o+=a}e=e.replace(t," "+o)}return e},e.findItemOnAlternateProvider=function(e,t,n,r,u){var a=null;u=typeof u!="undefined"?u:null;switch(t){case o.SEARCH_PROVIDERS.Amazon:var c=e.standardName;a=s.searchGiantBomb(c,function(t){l(t,e,r,u)});break;case o.SEARCH_PROVIDERS.GiantBomb:var h=0;e.platform!=="n/a"&&(h=o.getStandardPlatform(e.platform).amazon),a=i.searchAmazon(e.name,h,function(t){f(t,e,r,u,!1)},u,n)}return a},e.getLinkedItemData=function(e,t,n){switch(t){case o.SEARCH_PROVIDERS.Amazon:s.getGiantBombItemDetail(e.gbombID,function(e){a(e,n)});break;case o.SEARCH_PROVIDERS.GiantBomb:i.getAmazonItemDetail(e.asin,function(e){u(e,n)})}},e.findWikipediaMatch=function(t,n,r){var i=t,s={},o=null,u=-99999,a=0;for(var f=0,l=i.length;f<l;f++)s={name:i[f]},f===0&&(o=s),a=e.getSimilarityScore(n,s),a>u&&(o=s,u=a);i.length!==0&&r(o)};var u=function(e,t){var r={};n("Item",e).each(function(){r=i.parseAmazonResultItem(n(this))}),t(r)},a=function(e,t){var n=s.parseGiantBombResultItem(e);t(n)},f=function(t,r,s,o,u){var a=n("Item",t).length,l={},c=0,h=null,p=-99999,d=0;n("Item",t).each(function(){l=i.parseAmazonResultItem(n(this)),typeof l.isFiltered=="undefined"&&(c===0&&(h=l),c++,d=e.getSimilarityScore(r,l),d>p&&(h=l,p=d))}),h?s(h):u?o():i.searchAmazon(r.name,0,function(e){f(e,r,s,o,!0)},o)},l=function(t,n,r,i){var o=t.results,u={},a=null,f=-99999,l=0;for(var c=0,h=o.length;c<h;c++)u=s.parseGiantBombResultItem(o[c]),c===0&&(a=u),l=e.getSimilarityScore(n,u),l>f&&(a=u,f=l);o.length!==0?r(a):i()}}(tmz.module("itemLinker"),tmz,jQuery,_),function(e,t,n,r,i){"use strict";var s=t.module("user"),o=t.module("utilities"),u=t.module("itemData"),a=t.module("tagView"),f=t.module("itemView"),l=t.module("amazon"),c=t.module("metacritic"),h=t.module("itemLinker"),p=t.module("giantbomb"),d=["Steam","PSN","XBL"],v=["Steam ID","PSN ID","Gamertag"],m=["http://steamcommunity.com/id/[steam_id]","http://us.playstation.com/mytrophies/","https://live.xbox.com/en-US/Friends"],g=[["PC","Mac"],["PSN","PS3","Vita"],["Xbox","Xbox360"]],y="http://d2sifwlm28j6up.cloudfront.net/no_match.png",b="Loading Data: ",w="Importing: ",E=0,S=0,x=0,T=0,N=0,C=0,k=null,L={},A=0,O=[],M=[],_=[],D=n("#importContainer"),P=n("#importResults"),H=n("#importResults tbody"),B=n("#startImport_btn"),j=n("#confirmImport_btn"),F=n("#cancelImport_btn"),I=n("#sourceUser"),q=n(".importSourceID"),R=n(".importSourceName"),U=n(".importSourceURL"),z=n("#importConfig-modal"),W=n("#import-modal"),X=n("#importProgressContainer"),V=n("#importProgress"),$=V.find(".bar"),J=n("#importStatus"),K=J.find(".statusTitle"),Q=J.find(".statusText"),G=null,Y=r.template(n("#import-results-template").html()),Z=function(){et()},et=function(){B.click(function(e){e.preventDefault(),I.val()!==""&&it(I.val())}),I.keyup(function(e){e.preventDefault(),e.which===13&&I.val()!==""&&it(I.val())}),j.click(function(e){e.preventDefault(),xt()}),F.click(function(e){e.preventDefault(),st()})},tt=function(){P.html("")},nt=function(e){k=e,r.has(L,e)?(z.modal("hide"),W.modal("show")):rt()},rt=function(){q.text(v[k]),R.text(d[k]);var e=m[k],t='<a href="'+e+'" target="_blank">'+e+"</a>";U.html(t),z.modal("show"),r.delay(function(){I.focus().select()},800)},it=function(e){L[k]=!0,M=[],E=0,S=0,x=0,T=0,G=lt.lazy(1200,2e3),A++,H.empty(),bt(b),z.modal("hide"),W.modal("show"),u.importGames(k,e,function(e){ot(e,g[k])}),i.success("Importing "+d[k]+" games for: "+e)},st=function(){delete L[k],A++,r.each(_,function(e,t){e&&r.has(e,"abort")&&e.abort()}),rt(),W.modal("hide"),i.error(d[k]+" import cancelled")},ot=function(e,t){O=e,x=O.length,_=[],r.each(O,function(e){e=h.standardizeTitle(e);var n=ut(e,t);_.push(n)})},ut=function(e,t){var n={initialProvider:1,standardName:e},r=h.findItemOnAlternateProvider(n,o.SEARCH_PROVIDERS.Amazon,!1,function(r){at(e,r,n,t)},function(){ht(e)});return r},at=function(e,t,i,s){n.extend(!0,i,t);var u=p.getGiantBombItemPlatform(i.id,function(t){var n=[];for(var u=0,a=t.results.platforms.length;u<a;u++){var f=o.matchPlatformToIndex(t.results.platforms[u].name).name;n.push(f)}var l=r.intersection(n,s);i.platform=l[0],i.platform?(E+=2,G(i,dt,A),ft(i),ct(i)):ht(e)});_.push(u)},ft=function(e){var t=c.getMetascore(e.standardName,e,!0,vt);_.push(t)},lt=function(e,t,n){if(A!==n)return;var r=h.findItemOnAlternateProvider(e,o.SEARCH_PROVIDERS.GiantBomb,!1,function(n){e.asin=n.asin,t()},function(){t()});_.push(r)},ct=function(e){e.importClass="imported",T===0&&wt(),T++,M.push(e),pt(e),gt()},ht=function(e){var t={thumbnailImage:y,name:e,calendarDate:"",platform:"Title not found: please add manually",importClass:"importFailed"};pt(t)},pt=function(e){var t={item:e};H.append(Y(t))},dt=function(){mt()},vt=function(e){mt()},mt=function(){S++,gt(),E==S&&St()},gt=function(){var e=x+E,t=T+S,n=Math.round(t/e*100);$.css({width:n+"%"}),Q.text(t+" of "+e)},yt=function(){var e=Math.round(C/N*100);$.css({width:e+"%"}),Q.text(C+" of "+N)},bt=function(e){W.removeClass("ready").addClass("loading"),X.removeClass("show"),$.css({width:"0%"}),K.text(e)},wt=function(){X.addClass("show"),W.removeClass("ready").removeClass("loading")},Et=function(){X.removeClass("show"),r.delay(function(){$.css({width:"0%"})},1e3)},St=function(){Et(),r.delay(function(){W.addClass("ready")},1e3),i.success(x+" titles found and linked for "+d[k])},xt=function(){K.text(w),wt();var e=d[k].toLowerCase()+" import";N=M.length,C=0,a.addTag(e,function(t){var n=[t.tagID];r.each(M,function(t){u.addItemToTags(n,t,function(t){C++,yt(),C===N&&Tt(n,e)})})})},Tt=function(e,t){i.success(d[k]+" Import Complete"),i.log("Games added to tag: "+t),W.modal("hide"),f.refreshView(),a.updateViewList(e),f.viewRandomItem(),delete L[k],k=null},Nt={init:Z,startImport:nt};n.extend(e,Nt)}(tmz.module("importView"),tmz,jQuery,_,alertify),tmz.initialize();